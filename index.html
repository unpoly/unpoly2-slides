<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"><meta name="apple-mobile-web-app-capable" content="yes"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><style>.bespoke-marp-note,.bespoke-marp-osc,.bespoke-progress-parent{display:none;transition:none}@media screen{body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border:0;color:inherit;cursor:pointer;font-size:inherit;opacity:.8;outline:none;padding:0;transition:opacity .2s linear;-webkit-tap-highlight-color:transparent}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:disabled,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:disabled{cursor:not-allowed;opacity:.15!important}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover{opacity:1}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:active,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:active{opacity:.6}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button:hover:not(:disabled),body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button:hover:not(:disabled){transition:none}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-prev{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNNjggOTBMMjggNTBsNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button.bespoke-marp-presenter-info-page-next{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cGF0aCBmaWxsPSJub25lIiBzdHJva2U9IiNmZmYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLXdpZHRoPSI1IiBkPSJNMzIgOTBsNDAtNDAtNDAtNDAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTQwIDcwSDIwVjUwbTIwIDBMMjAgNzBtNDAtNDBoMjB2MjBtLTIwIDBsMjAtMjAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button.exit[data-bespoke-marp-osc=fullscreen]{background-image:url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6NXB4fTwvc3R5bGU+PC9kZWZzPjxyZWN0IGNsYXNzPSJhIiB4PSIxMCIgeT0iMjAiIHdpZHRoPSI4MCIgaGVpZ2h0PSI2MCIgcng9IjUuNjciLz48cGF0aCBjbGFzcz0iYSIgZD0iTTIwIDUwaDIwdjIwbS0yMCAwbDIwLTIwbTQwIDBINjBWMzBtMjAgMEw2MCA1MCIvPjwvc3ZnPg==")}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter]{background:transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48ZGVmcz48c3R5bGU+LmF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS13aWR0aDo1cHh9PC9zdHlsZT48L2RlZnM+PHBhdGggY2xhc3M9ImEiIGQ9Ik0yMCA2MGgtNWE1IDUgMCAwMS01LTVWMjBhNSA1IDAgMDE1LTVoNjBhNSA1IDAgMDE1IDV2NU0zMCA4NWg2MCIvPjxyZWN0IHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmIi8+PHJlY3QgY2xhc3M9ImEiIHg9IjMwIiB5PSIzNSIgd2lkdGg9IjYwIiBoZWlnaHQ9IjQwIiByeD0iNSIvPjxwYXRoIGNsYXNzPSJhIiBkPSJNNDAgNTBoNDBNNDAgNjBoMzAiLz48L3N2Zz4=") no-repeat 50%;background-size:contain;overflow:hidden;text-indent:100%;white-space:nowrap}body,html{height:100%;margin:0}body{background:#000;overflow:hidden}svg.bespoke-marp-slide{content-visibility:hidden;z-index:-1;pointer-events:none;opacity:0}svg.bespoke-marp-slide.bespoke-marp-active{content-visibility:visible;z-index:0;pointer-events:auto;opacity:1}svg.bespoke-marp-slide.bespoke-marp-active.bespoke-marp-active-ready *{-webkit-animation-name:__bespoke_marp__!important;animation-name:__bespoke_marp__!important}@supports not (content-visibility:hidden){svg.bespoke-marp-slide[data-bespoke-marp-load=hideable]{display:none}svg.bespoke-marp-slide[data-bespoke-marp-load=hideable].bespoke-marp-active{display:block}}[data-bespoke-marp-fragment=inactive]{visibility:hidden}body[data-bespoke-view=""] .bespoke-marp-parent,body[data-bespoke-view=next] .bespoke-marp-parent{bottom:0;left:0;position:absolute;right:0;top:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc{background:rgba(0,0,0,.65);border-radius:7px;bottom:50px;color:#fff;display:block;font-family:Helvetica,Arial,sans-serif;font-size:16px;left:50%;line-height:0;opacity:1;padding:12px;position:absolute;touch-action:manipulation;transform:translateX(-50%);transition:opacity .2s linear;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;z-index:1;will-change:transform}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>*,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>*{margin-left:6px}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>:first-child,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>:first-child{margin-left:0}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span,body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span{opacity:.8}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>span[data-bespoke-marp-osc=page]{display:inline-block;min-width:140px;text-align:center}body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=""] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=fullscreen],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=next],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=presenter],body[data-bespoke-view=next] .bespoke-marp-parent>.bespoke-marp-osc>button[data-bespoke-marp-osc=prev]{height:32px;line-height:32px;width:32px}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive{cursor:none}body[data-bespoke-view=""] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc,body[data-bespoke-view=next] .bespoke-marp-parent.bespoke-marp-inactive>.bespoke-marp-osc{opacity:0;pointer-events:none}body[data-bespoke-view=""] svg.bespoke-marp-slide,body[data-bespoke-view=next] svg.bespoke-marp-slide{height:100%;left:0;position:absolute;top:0;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent{background:#222;display:flex;height:5px;width:100%}body[data-bespoke-view=""] .bespoke-progress-parent+.bespoke-marp-parent{top:5px}body[data-bespoke-view=""] .bespoke-progress-parent .bespoke-progress-bar{flex:0 0 0;background:#0288d1;transition:flex-basis .2s cubic-bezier(0,1,1,1)}body[data-bespoke-view=next]{background:transparent}body[data-bespoke-view=presenter]{background:#161616}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container{font-family:Helvetica,Arial,sans-serif;height:100%;left:0;position:absolute;top:0;width:100%;display:grid;grid-template-columns:2fr 1fr;grid-template-rows:minmax(140px,1fr) 2fr 3em;grid-template-areas:"current next" "current note" "info    note"}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent{grid-area:current;position:relative;overflow:hidden}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide{height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;top:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-parent svg.bespoke-marp-slide.bespoke-marp-active{filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container{background:#222;cursor:pointer;display:none;grid-area:next;overflow:hidden;position:relative}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-next-container iframe.bespoke-marp-presenter-next{background:transparent;border:0;display:block;filter:drop-shadow(0 3px 10px rgba(0,0,0,.5));height:calc(100% - 40px);left:20px;position:absolute;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;top:20px;width:calc(100% - 40px)}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container{background:#222;color:#eee;grid-area:note}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note{margin:20px;width:calc(100% - 40px);height:calc(100% - 40px);box-sizing:border-box;font-size:1.1em;overflow:auto;padding-right:3px;white-space:pre-wrap;word-wrap:break-word;scrollbar-width:thin;scrollbar-color:hsla(0,0%,93.3%,.5) transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar{width:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-track{background:transparent}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note::-webkit-scrollbar-thumb{background:hsla(0,0%,93.3%,.5);border-radius:6px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note:empty{pointer-events:none}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note.active{display:block}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:first-child{margin-top:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-note-container .bespoke-marp-note p:last-child{margin-bottom:0}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container{align-items:center;box-sizing:border-box;color:#eee;display:flex;flex-wrap:nowrap;grid-area:info;justify-content:center;padding:0 10px}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time,body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{display:block;box-sizing:border-box;padding:0 10px;white-space:nowrap;width:100%}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container button{height:1.5em;line-height:1.5em;width:1.5em}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page{order:2;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-page .bespoke-marp-presenter-info-page-text{display:inline-block;min-width:120px;text-align:center}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-time{color:#999;order:1;text-align:left}body[data-bespoke-view=presenter] .bespoke-marp-presenter-container .bespoke-marp-presenter-info-container .bespoke-marp-presenter-info-timer{color:#999;order:3;text-align:right}}@media print{.bespoke-marp-presenter-info-container,.bespoke-marp-presenter-next-container,.bespoke-marp-presenter-note-container{display:none}}</style><style>@import url('https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,300;1,400;1,700&display=swap');@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');div#p>svg>foreignObject>section{width:1280px;height:720px;box-sizing:border-box;overflow:hidden;position:relative;scroll-snap-align:center center}div#p>svg>foreignObject>section:after{bottom:0;content:attr(data-marpit-pagination);padding:inherit;pointer-events:none;position:absolute;right:0}div#p>svg>foreignObject>section:not([data-marpit-pagination]):after{display:none}/* Normalization */div#p>svg>foreignObject>section h1{font-size:2em;margin:0.67em 0}div#p>svg>foreignObject>section video::-webkit-media-controls{will-change:transform}@page{size:1280px 720px;margin:0}@media print{body,html{background-color:#fff;margin:0;page-break-inside:avoid;break-inside:avoid-page}div#p>svg>foreignObject>section{page-break-before:always;break-before:page}div#p>svg>foreignObject>section,div#p>svg>foreignObject>section *{-webkit-print-color-adjust:exact!important;animation-delay:0s!important;animation-duration:0s!important;color-adjust:exact!important;transition:none!important}div#p>svg[data-marpit-svg]{display:block;height:100vh;width:100vw}}
/*!
 * Marp default theme.
 *
 * @theme default
 * @author Yuki Hattori
 *
 * @auto-scaling true
 * @size 4:3 960px 720px
 */div#p>svg>foreignObject>section .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}div#p>svg>foreignObject>section .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}div#p>svg>foreignObject>section .anchor:focus{outline:none}div#p>svg>foreignObject>section h1 .octicon-link,div#p>svg>foreignObject>section h2 .octicon-link,div#p>svg>foreignObject>section h3 .octicon-link,div#p>svg>foreignObject>section h4 .octicon-link,div#p>svg>foreignObject>section h5 .octicon-link,div#p>svg>foreignObject>section h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}div#p>svg>foreignObject>section h1:hover .anchor,div#p>svg>foreignObject>section h2:hover .anchor,div#p>svg>foreignObject>section h3:hover .anchor,div#p>svg>foreignObject>section h4:hover .anchor,div#p>svg>foreignObject>section h5:hover .anchor,div#p>svg>foreignObject>section h6:hover .anchor{text-decoration:none}div#p>svg>foreignObject>section h1:hover .anchor .octicon-link,div#p>svg>foreignObject>section h2:hover .anchor .octicon-link,div#p>svg>foreignObject>section h3:hover .anchor .octicon-link,div#p>svg>foreignObject>section h4:hover .anchor .octicon-link,div#p>svg>foreignObject>section h5:hover .anchor .octicon-link,div#p>svg>foreignObject>section h6:hover .anchor .octicon-link{visibility:visible}div#p>svg>foreignObject>section h1:hover .anchor .octicon-link:before,div#p>svg>foreignObject>section h2:hover .anchor .octicon-link:before,div#p>svg>foreignObject>section h3:hover .anchor .octicon-link:before,div#p>svg>foreignObject>section h4:hover .anchor .octicon-link:before,div#p>svg>foreignObject>section h5:hover .anchor .octicon-link:before,div#p>svg>foreignObject>section h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}div#p>svg>foreignObject>section{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}div#p>svg>foreignObject>section{--marpit-root-font-size:16px}div#p>svg>foreignObject>section details{display:block}div#p>svg>foreignObject>section summary{display:list-item}div#p>svg>foreignObject>section a{background-color:initial}div#p>svg>foreignObject>section a:active,div#p>svg>foreignObject>section a:hover{outline-width:0}div#p>svg>foreignObject>section strong{font-weight:inherit;font-weight:bolder}div#p>svg>foreignObject>section h1{margin:.67em 0}div#p>svg>foreignObject>section img{border-style:none}div#p>svg>foreignObject>section code,div#p>svg>foreignObject>section kbd,div#p>svg>foreignObject>section pre{font-family:monospace,monospace;font-size:1em}div#p>svg>foreignObject>section hr{box-sizing:initial;overflow:visible}div#p>svg>foreignObject>section input{font:inherit;margin:0;overflow:visible}div#p>svg>foreignObject>section [type=checkbox]{padding:0}div#p>svg>foreignObject>section *,div#p>svg>foreignObject>section [type=checkbox]{box-sizing:border-box}div#p>svg>foreignObject>section input{font-family:inherit;font-size:inherit;line-height:inherit}div#p>svg>foreignObject>section a{color:#0366d6;text-decoration:none}div#p>svg>foreignObject>section a:hover{text-decoration:underline}div#p>svg>foreignObject>section strong{font-weight:600}div#p>svg>foreignObject>section hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}div#p>svg>foreignObject>section hr:after,div#p>svg>foreignObject>section hr:before{display:table;content:""}div#p>svg>foreignObject>section hr:after{clear:both}div#p>svg>foreignObject>section table{border-spacing:0;border-collapse:collapse}div#p>svg>foreignObject>section td,div#p>svg>foreignObject>section th{padding:0}div#p>svg>foreignObject>section details summary{cursor:pointer}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2,div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4,div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{margin-top:0;margin-bottom:0}div#p>svg>foreignObject>section h1{font-size:32px}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2{font-weight:600}div#p>svg>foreignObject>section h2{font-size:24px}div#p>svg>foreignObject>section h3{font-size:20px}div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4{font-weight:600}div#p>svg>foreignObject>section h4{font-size:16px}div#p>svg>foreignObject>section h5{font-size:14px}div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{font-weight:600}div#p>svg>foreignObject>section h6{font-size:12px}div#p>svg>foreignObject>section p{margin-top:0;margin-bottom:10px}div#p>svg>foreignObject>section blockquote{margin:0}div#p>svg>foreignObject>section ol,div#p>svg>foreignObject>section ul{padding-left:0;margin-top:0;margin-bottom:0}div#p>svg>foreignObject>section ol ol,div#p>svg>foreignObject>section ul ol{list-style-type:lower-roman}div#p>svg>foreignObject>section ol ol ol,div#p>svg>foreignObject>section ol ul ol,div#p>svg>foreignObject>section ul ol ol,div#p>svg>foreignObject>section ul ul ol{list-style-type:lower-alpha}div#p>svg>foreignObject>section dd{margin-left:0}div#p>svg>foreignObject>section code,div#p>svg>foreignObject>section pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}div#p>svg>foreignObject>section pre{margin-top:0;margin-bottom:0}div#p>svg>foreignObject>section input::-webkit-inner-spin-button,div#p>svg>foreignObject>section input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}div#p>svg>foreignObject>section :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}div#p>svg>foreignObject>section .border{border:1px solid #e1e4e8!important}div#p>svg>foreignObject>section .border-0{border:0!important}div#p>svg>foreignObject>section .border-bottom{border-bottom:1px solid #e1e4e8!important}div#p>svg>foreignObject>section .rounded-1{border-radius:3px!important}div#p>svg>foreignObject>section .bg-white{background-color:#fff!important}div#p>svg>foreignObject>section .bg-gray-light{background-color:#fafbfc!important}div#p>svg>foreignObject>section .text-gray-light{color:#6a737d!important}div#p>svg>foreignObject>section .pl-3,div#p>svg>foreignObject>section .px-3{padding-left:16px!important}div#p>svg>foreignObject>section .px-3{padding-right:16px!important}div#p>svg>foreignObject>section .f6{font-size:12px!important}div#p>svg>foreignObject>section div#p>svg>foreignObject>section section.f6{--marpit-root-font-size:12px!important}div#p>svg>foreignObject>section .lh-condensed{line-height:1.25!important}div#p>svg>foreignObject>section .text-bold{font-weight:600!important}div#p>svg>foreignObject>section .pl-c{color:#6a737d}div#p>svg>foreignObject>section .pl-c1,div#p>svg>foreignObject>section .pl-s .pl-v{color:#005cc5}div#p>svg>foreignObject>section .pl-e,div#p>svg>foreignObject>section .pl-en{color:#6f42c1}div#p>svg>foreignObject>section .pl-s .pl-s1,div#p>svg>foreignObject>section .pl-smi{color:#24292e}div#p>svg>foreignObject>section .pl-ent{color:#22863a}div#p>svg>foreignObject>section .pl-k{color:#d73a49}div#p>svg>foreignObject>section .pl-pds,div#p>svg>foreignObject>section .pl-s,div#p>svg>foreignObject>section .pl-s .pl-pse .pl-s1,div#p>svg>foreignObject>section .pl-sr,div#p>svg>foreignObject>section .pl-sr .pl-cce,div#p>svg>foreignObject>section .pl-sr .pl-sra,div#p>svg>foreignObject>section .pl-sr .pl-sre{color:#032f62}div#p>svg>foreignObject>section .pl-smw,div#p>svg>foreignObject>section .pl-v{color:#e36209}div#p>svg>foreignObject>section .pl-bu{color:#b31d28}div#p>svg>foreignObject>section .pl-ii{color:#fafbfc;background-color:#b31d28}div#p>svg>foreignObject>section .pl-c2{color:#fafbfc;background-color:#d73a49}div#p>svg>foreignObject>section .pl-c2:before{content:"^M"}div#p>svg>foreignObject>section .pl-sr .pl-cce{font-weight:700;color:#22863a}div#p>svg>foreignObject>section .pl-ml{color:#735c0f}div#p>svg>foreignObject>section .pl-mh,div#p>svg>foreignObject>section .pl-mh .pl-en,div#p>svg>foreignObject>section .pl-ms{font-weight:700;color:#005cc5}div#p>svg>foreignObject>section .pl-mi{font-style:italic;color:#24292e}div#p>svg>foreignObject>section .pl-mb{font-weight:700;color:#24292e}div#p>svg>foreignObject>section .pl-md{color:#b31d28;background-color:#ffeef0}div#p>svg>foreignObject>section .pl-mi1{color:#22863a;background-color:#f0fff4}div#p>svg>foreignObject>section .pl-mc{color:#e36209;background-color:#ffebda}div#p>svg>foreignObject>section .pl-mi2{color:#f6f8fa;background-color:#005cc5}div#p>svg>foreignObject>section .pl-mdr{font-weight:700;color:#6f42c1}div#p>svg>foreignObject>section .pl-ba{color:#586069}div#p>svg>foreignObject>section .pl-sg{color:#959da5}div#p>svg>foreignObject>section .pl-corl{text-decoration:underline;color:#032f62}div#p>svg>foreignObject>section .mb-0{margin-bottom:0!important}div#p>svg>foreignObject>section .my-2{margin-bottom:8px!important;margin-top:8px!important}div#p>svg>foreignObject>section .pl-0{padding-left:0!important}div#p>svg>foreignObject>section .py-0{padding-top:0!important;padding-bottom:0!important}div#p>svg>foreignObject>section .pl-1{padding-left:4px!important}div#p>svg>foreignObject>section .pl-2{padding-left:8px!important}div#p>svg>foreignObject>section .py-2{padding-top:8px!important;padding-bottom:8px!important}div#p>svg>foreignObject>section .pl-3{padding-left:16px!important}div#p>svg>foreignObject>section .pl-4{padding-left:24px!important}div#p>svg>foreignObject>section .pl-5{padding-left:32px!important}div#p>svg>foreignObject>section .pl-6{padding-left:40px!important}div#p>svg>foreignObject>section .pl-7{padding-left:48px!important}div#p>svg>foreignObject>section .pl-8{padding-left:64px!important}div#p>svg>foreignObject>section .pl-9{padding-left:80px!important}div#p>svg>foreignObject>section .pl-10{padding-left:96px!important}div#p>svg>foreignObject>section .pl-11{padding-left:112px!important}div#p>svg>foreignObject>section .pl-12{padding-left:128px!important}div#p>svg>foreignObject>section hr{border-bottom-color:#eee}div#p>svg>foreignObject>section kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}div#p>svg>foreignObject>section:after,div#p>svg>foreignObject>section:before{display:table
  /* content:""; */}div#p>svg>foreignObject>section:after{clear:both}div#p>svg>foreignObject>section>:first-child{margin-top:0!important}div#p>svg>foreignObject>section>:last-child{margin-bottom:0!important}div#p>svg>foreignObject>section a:not([href]){color:inherit;text-decoration:none}div#p>svg>foreignObject>section blockquote,div#p>svg>foreignObject>section details,div#p>svg>foreignObject>section dl,div#p>svg>foreignObject>section ol,div#p>svg>foreignObject>section p,div#p>svg>foreignObject>section pre,div#p>svg>foreignObject>section table,div#p>svg>foreignObject>section ul{margin-top:0;margin-bottom:16px}div#p>svg>foreignObject>section hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}div#p>svg>foreignObject>section blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}div#p>svg>foreignObject>section blockquote>:first-child{margin-top:0}div#p>svg>foreignObject>section blockquote>:last-child{margin-bottom:0}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2,div#p>svg>foreignObject>section h3,div#p>svg>foreignObject>section h4,div#p>svg>foreignObject>section h5,div#p>svg>foreignObject>section h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}div#p>svg>foreignObject>section h1{font-size:2em}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}div#p>svg>foreignObject>section h2{font-size:1.5em}div#p>svg>foreignObject>section h3{font-size:1.25em}div#p>svg>foreignObject>section h4{font-size:1em}div#p>svg>foreignObject>section h5{font-size:.875em}div#p>svg>foreignObject>section h6{font-size:.85em;color:#6a737d}div#p>svg>foreignObject>section ol,div#p>svg>foreignObject>section ul{padding-left:2em}div#p>svg>foreignObject>section ol ol,div#p>svg>foreignObject>section ol ul,div#p>svg>foreignObject>section ul ol,div#p>svg>foreignObject>section ul ul{margin-top:0;margin-bottom:0}div#p>svg>foreignObject>section li{word-wrap:break-all}div#p>svg>foreignObject>section li>p{margin-top:16px}div#p>svg>foreignObject>section li+li{margin-top:.25em}div#p>svg>foreignObject>section dl{padding:0}div#p>svg>foreignObject>section dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}div#p>svg>foreignObject>section dl dd{padding:0 16px;margin-bottom:16px}div#p>svg>foreignObject>section table{display:block;width:100%;overflow:auto}div#p>svg>foreignObject>section table th{font-weight:600}div#p>svg>foreignObject>section table td,div#p>svg>foreignObject>section table th{padding:6px 13px;border:1px solid #dfe2e5}div#p>svg>foreignObject>section table tr{background-color:#fff;border-top:1px solid #c6cbd1}div#p>svg>foreignObject>section table tr:nth-child(2n){background-color:#f6f8fa}div#p>svg>foreignObject>section img{max-width:100%;box-sizing:initial;background-color:#fff}div#p>svg>foreignObject>section img[align=right]{padding-left:20px}div#p>svg>foreignObject>section img[align=left]{padding-right:20px}div#p>svg>foreignObject>section code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}div#p>svg>foreignObject>section pre{word-wrap:normal}div#p>svg>foreignObject>section pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}div#p>svg>foreignObject>section .highlight{margin-bottom:16px}div#p>svg>foreignObject>section .highlight pre{margin-bottom:0;word-break:normal}div#p>svg>foreignObject>section pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}div#p>svg>foreignObject>section pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}div#p>svg>foreignObject>section .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}div#p>svg>foreignObject>section div#p>svg>foreignObject>section section.commit-tease-sha{--marpit-root-font-size:90%}div#p>svg>foreignObject>section .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}div#p>svg>foreignObject>section .blob-wrapper{overflow-x:auto;overflow-y:hidden}div#p>svg>foreignObject>section .blob-wrapper-embedded{max-height:240px;overflow-y:auto}div#p>svg>foreignObject>section .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}div#p>svg>foreignObject>section div#p>svg>foreignObject>section section.blob-num{--marpit-root-font-size:12px}div#p>svg>foreignObject>section .blob-num:hover{color:rgba(27,31,35,.6)}div#p>svg>foreignObject>section .blob-num:before{content:attr(data-line-number)}div#p>svg>foreignObject>section .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}div#p>svg>foreignObject>section .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}div#p>svg>foreignObject>section div#p>svg>foreignObject>section section.blob-code-inner{--marpit-root-font-size:12px}div#p>svg>foreignObject>section .pl-token.active,div#p>svg>foreignObject>section .pl-token:hover{cursor:pointer;background:#ffea7f}div#p>svg>foreignObject>section .tab-size[data-tab-size="1"]{-moz-tab-size:1;-o-tab-size:1;tab-size:1}div#p>svg>foreignObject>section .tab-size[data-tab-size="2"]{-moz-tab-size:2;-o-tab-size:2;tab-size:2}div#p>svg>foreignObject>section .tab-size[data-tab-size="3"]{-moz-tab-size:3;-o-tab-size:3;tab-size:3}div#p>svg>foreignObject>section .tab-size[data-tab-size="4"]{-moz-tab-size:4;-o-tab-size:4;tab-size:4}div#p>svg>foreignObject>section .tab-size[data-tab-size="5"]{-moz-tab-size:5;-o-tab-size:5;tab-size:5}div#p>svg>foreignObject>section .tab-size[data-tab-size="6"]{-moz-tab-size:6;-o-tab-size:6;tab-size:6}div#p>svg>foreignObject>section .tab-size[data-tab-size="7"]{-moz-tab-size:7;-o-tab-size:7;tab-size:7}div#p>svg>foreignObject>section .tab-size[data-tab-size="8"]{-moz-tab-size:8;-o-tab-size:8;tab-size:8}div#p>svg>foreignObject>section .tab-size[data-tab-size="9"]{-moz-tab-size:9;-o-tab-size:9;tab-size:9}div#p>svg>foreignObject>section .tab-size[data-tab-size="10"]{-moz-tab-size:10;-o-tab-size:10;tab-size:10}div#p>svg>foreignObject>section .tab-size[data-tab-size="11"]{-moz-tab-size:11;-o-tab-size:11;tab-size:11}div#p>svg>foreignObject>section .tab-size[data-tab-size="12"]{-moz-tab-size:12;-o-tab-size:12;tab-size:12}div#p>svg>foreignObject>section .task-list-item{list-style-type:none}div#p>svg>foreignObject>section .task-list-item+.task-list-item{margin-top:3px}div#p>svg>foreignObject>section .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}div#p>svg>foreignObject>section .hljs{display:block;background:#fff;padding:.5em;color:#333;overflow-x:auto}div#p>svg>foreignObject>section .hljs-comment,div#p>svg>foreignObject>section .hljs-meta{color:#969896}div#p>svg>foreignObject>section .hljs-emphasis,div#p>svg>foreignObject>section .hljs-quote,div#p>svg>foreignObject>section .hljs-strong,div#p>svg>foreignObject>section .hljs-template-variable,div#p>svg>foreignObject>section .hljs-variable{color:#df5000}div#p>svg>foreignObject>section .hljs-keyword,div#p>svg>foreignObject>section .hljs-selector-tag,div#p>svg>foreignObject>section .hljs-type{color:#d73a49}div#p>svg>foreignObject>section .hljs-attribute,div#p>svg>foreignObject>section .hljs-bullet,div#p>svg>foreignObject>section .hljs-literal,div#p>svg>foreignObject>section .hljs-symbol{color:#0086b3}div#p>svg>foreignObject>section .hljs-name,div#p>svg>foreignObject>section .hljs-section{color:#63a35c}div#p>svg>foreignObject>section .hljs-tag{color:#333}div#p>svg>foreignObject>section .hljs-attr,div#p>svg>foreignObject>section .hljs-selector-attr,div#p>svg>foreignObject>section .hljs-selector-class,div#p>svg>foreignObject>section .hljs-selector-id,div#p>svg>foreignObject>section .hljs-selector-pseudo,div#p>svg>foreignObject>section .hljs-title{color:#6f42c1}div#p>svg>foreignObject>section .hljs-addition{color:#55a532;background-color:#eaffea}div#p>svg>foreignObject>section .hljs-deletion{color:#bd2c00;background-color:#ffecec}div#p>svg>foreignObject>section .hljs-link{text-decoration:underline}div#p>svg>foreignObject>section .hljs-number{color:#005cc5}div#p>svg>foreignObject>section .hljs-string{color:#032f62}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{max-height:563px}div#p>svg>foreignObject>section h1{color:#246;font-size:1.6em}div#p>svg>foreignObject>section h1,div#p>svg>foreignObject>section h2{border-bottom:none}div#p>svg>foreignObject>section h2{font-size:1.3em}div#p>svg>foreignObject>section h3{font-size:1.1em}div#p>svg>foreignObject>section h4{font-size:1.05em}div#p>svg>foreignObject>section h5{font-size:1em}div#p>svg>foreignObject>section h6{font-size:.9em}div#p>svg>foreignObject>section h1 strong,div#p>svg>foreignObject>section h2 strong,div#p>svg>foreignObject>section h3 strong,div#p>svg>foreignObject>section h4 strong,div#p>svg>foreignObject>section h5 strong,div#p>svg>foreignObject>section h6 strong{font-weight:inherit;color:#48c}div#p>svg>foreignObject>section hr{height:0;padding-top:.25em}div#p>svg>foreignObject>section pre{border:1px solid #999;line-height:1.15;overflow:visible}div#p>svg>foreignObject>section pre code svg[data-marp-fitting=svg]{max-height:529px}div#p>svg>foreignObject>section footer,div#p>svg>foreignObject>section header{margin:0;position:absolute;left:30px;color:hsla(0,0%,40%,.75);font-size:18px}div#p>svg>foreignObject>section header{top:21px}div#p>svg>foreignObject>section footer{bottom:21px}div#p>svg>foreignObject>section{align-items:stretch;background:#fff;display:flex;flex-direction:column;flex-wrap:nowrap;font-size:29px;height:720px;justify-content:center;padding:78.5px;width:1280px}div#p>svg>foreignObject>section{--marpit-root-font-size:29px}div#p>svg>foreignObject>section>:last-child,div#p>svg>foreignObject>section[data-footer]>:nth-last-child(2){margin-bottom:0}div#p>svg>foreignObject>section>:first-child,div#p>svg>foreignObject>section>header:first-child+*{margin-top:0}div#p>svg>foreignObject>section:after{position:absolute;padding:0;right:30px;bottom:21px;font-size:24px;color:#777}div#p>svg>foreignObject>section:after{--marpit-root-font-size:24px}div#p>svg>foreignObject>section.invert{background-color:#222;color:#e6eaf0}div#p>svg>foreignObject>section.invert:after{color:#999}div#p>svg>foreignObject>section.invert img{background-color:transparent}div#p>svg>foreignObject>section.invert a{color:#50b3ff}div#p>svg>foreignObject>section.invert h1{color:#a3c5e7}div#p>svg>foreignObject>section.invert h2,div#p>svg>foreignObject>section.invert h3,div#p>svg>foreignObject>section.invert h4,div#p>svg>foreignObject>section.invert h5{color:#ebeff5}div#p>svg>foreignObject>section.invert blockquote,div#p>svg>foreignObject>section.invert h6{border-color:#3d3f43;color:#939699}div#p>svg>foreignObject>section.invert h1 strong,div#p>svg>foreignObject>section.invert h2 strong,div#p>svg>foreignObject>section.invert h3 strong,div#p>svg>foreignObject>section.invert h4 strong,div#p>svg>foreignObject>section.invert h5 strong,div#p>svg>foreignObject>section.invert h6 strong{color:#7bf}div#p>svg>foreignObject>section.invert hr{background-color:#3d3f43}div#p>svg>foreignObject>section.invert footer,div#p>svg>foreignObject>section.invert header{color:hsla(0,0%,60%,.75)}div#p>svg>foreignObject>section.invert code,div#p>svg>foreignObject>section.invert kbd{background-color:#111}div#p>svg>foreignObject>section.invert kbd{border-color:#666;box-shadow:inset 0 -1px 0 #555;color:#e6eaf0}div#p>svg>foreignObject>section.invert table tr{background-color:#12181d;border-color:#60657b}div#p>svg>foreignObject>section.invert table tr:nth-child(2n){background-color:#1b2024}div#p>svg>foreignObject>section.invert table td,div#p>svg>foreignObject>section.invert table th{border-color:#5b5e61}div#p>svg>foreignObject>section.invert pre{background-color:#0a0e12;border-color:#777}div#p>svg>foreignObject>section.invert pre code{background-color:transparent}div#p>svg>foreignObject>section[data-color] h1,div#p>svg>foreignObject>section[data-color] h2,div#p>svg>foreignObject>section[data-color] h3,div#p>svg>foreignObject>section[data-color] h4,div#p>svg>foreignObject>section[data-color] h5,div#p>svg>foreignObject>section[data-color] h6{color:currentColor}div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{display:block;height:auto;width:100%}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg]{position:static}}div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{content:""}@supports (-ms-ime-align:auto){div#p>svg>foreignObject>section svg[data-marp-fitting=svg].__reflow__{position:relative}}div#p>svg>foreignObject>section [data-marp-fitting-svg-content]{display:table;white-space:nowrap}div#p>svg>foreignObject>section [data-marp-fitting-svg-content-wrap]{white-space:pre}div#p>svg>foreignObject>section img[data-marp-twemoji]{background:transparent;height:1em;margin:0 .05em 0 .1em;vertical-align:-.1em;width:1em}

/* @theme unpoly2-slides */div#p>svg>foreignObject>section html{}div#p>svg>foreignObject>section{
  /* --highlight-color: #dd4232; */font-family:Roboto,sans-serif;font-size:25px;line-height:1.35}div#p>svg>foreignObject>section{--marpit-root-font-size:25px}div#p>svg>foreignObject>section:not(.no-watermark):not(.title){background-image:url('./images/unpoly2.svg');background-position:top 40px right 40px;background-size:250px;background-repeat:no-repeat}div#p>svg>foreignObject>section .muted{opacity:0.5}div#p>svg>foreignObject>section h1{xfont-size:2em;color:#3366bb;color:#ff3366;color:#f43;xfont-family:Orbitron,sans-serif;xtext-transform:uppercase;position:relative}

/*
h1:before {
  content: '';
  position: absolute;
  top: 0.2em;
  left: -5em;
  width: 4.5em;
  background-color: #f43;
  height: 0.8em;
  opacity: 0.5;
}
*/div#p>svg>foreignObject>section .row{display:flex}div#p>svg>foreignObject>section .col{flex:1 1 0}div#p>svg>foreignObject>section .col+.col{margin-left:2em}div#p>svg>foreignObject>section .title{margin:0 auto}div#p>svg>foreignObject>section .title--logo{width:600px}div#p>svg>foreignObject>section .title--author{border-top:2px solid currentColor;font-weight:bold;width:380px;text-align:center;margin:15px auto 0;padding-top:10px}div#p>svg>foreignObject>section.topic h1{font-size:3em;font-family:Orbitron,sans-serif;text-transform:uppercase}div#p>svg>foreignObject>section.align-top{justify-content:flex-start}

/*
.learning-box {
  display: block;
  margin-bottom: 1em;
  font-weight: bold;
  
  border: 1px solid #f83;
  border-radius: 3px;
  padding: 0.5em;
  padding-left: 2em;
  background-color: #fff6ee;
  position: relative;
}

.learning-box::before {
  content: 'ðŸ’¡';
  position: absolute;
  left: 0.5em;
  top: 0.5em;

}
*/div#p>svg>foreignObject>section th{text-align:left}div#p>svg>foreignObject>section img.picture{border:1px solid #555;border-radius:3px;box-shadow:0 4px 9px rgba(40,40,40,0.2)}div#p>svg>foreignObject>section a[href]{text-decoration:underline}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]{display:block!important;padding:0!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=background]:before,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:after,div#p>svg>foreignObject>section[data-marpit-advanced-background=content]:before{display:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]{all:initial;display:flex;flex-direction:row;height:100%;overflow:hidden;width:100%}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container][data-marpit-advanced-background-direction=vertical]{flex-direction:column}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split]>div[data-marpit-advanced-background-container]{width:var(--marpit-advanced-background-split,50%)}div#p>svg>foreignObject>section[data-marpit-advanced-background=background][data-marpit-advanced-background-split=right]>div[data-marpit-advanced-background-container]{margin-left:calc(100% - var(--marpit-advanced-background-split, 50%))}div#p>svg>foreignObject>section[data-marpit-advanced-background=background]>div[data-marpit-advanced-background-container]>figure{all:initial;background-position:center;background-repeat:no-repeat;background-size:cover;flex:auto;margin:0}div#p>svg>foreignObject>section[data-marpit-advanced-background=content],div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo]{background:transparent!important}div#p>svg>foreignObject>section[data-marpit-advanced-background=pseudo],div#p>svg[data-marpit-svg]>foreignObject[data-marpit-advanced-background=pseudo]{pointer-events:none!important}div#p>svg>foreignObject>section[data-marpit-advanced-background-split]{width:100%;height:100%}</style></head><body><div class="bespoke-marp-osc"><button data-bespoke-marp-osc="prev" tabindex="-1" title="Previous slide">Previous slide</button><span data-bespoke-marp-osc="page"></span><button data-bespoke-marp-osc="next" tabindex="-1" title="Next slide">Next slide</button><button data-bespoke-marp-osc="fullscreen" tabindex="-1" title="Toggle fullscreen (f)">Toggle fullscreen</button><button data-bespoke-marp-osc="presenter" tabindex="-1" title="Open presenter view (p)">Open presenter view</button></div><div id="p"><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="1" data-class="no-watermark" data-theme="unpoly2-slides" class="no-watermark" style="--class:no-watermark;--theme:unpoly2-slides;"><div class="title">
  <img src="./images/unpoly2.svg" alt="Unpoly 2" class="title--logo" />
  <div class="title--author">
    Henning Koch&nbsp; @triskweline
  </div>  
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="2" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>About Unpoly</h1>
<p><a href="https://unpoly.com">Unpoly</a> is an unobtrusive JavaScript framework for server-side web applications.<br />
It enables fast and flexible frontends while keeping rendering logic on the server.</p>
<p>This presentation is for experienced Unpoly 1 users<br />
who want to learn about the major changes in Unpoly 2.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="3" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Roadmap</h1>
<p>There will be two major Unpoly releases in <strong>December 2020 / January 2021</strong>:</p>
<ul>
<li>The current version 0.62.1 will be published as <strong>Unpoly 1.0</strong>.</li>
<li><strong>Unpoly 2.0</strong> will be released as a major upgrade.</li>
</ul>
<p>Unpoly 2 is the result of many observations of my colleagues at makandra, and the limits they ran into when using Unpoly for non-trivial interactions. I also looked through a lot of code on our Gitlab to see how Unpoly was used in the wild.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="4" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Unpoly 2 objectives</h1>
<div class="row">
<div class="col">
<h3>Kill boilerplate configuration</h3>
<p>Repetitive configuration code is now the default.
New, unopionated Bootstrap integration.</p>
<h3>Layer API</h3>
<p>A new layer API replaces modals and popups.<br />
Layers are isolated and can be stacked infinitly.</p>
<h3>Sub-interactions</h3>
<p>Branch off sub-interaction into an overlay.<br />
Overlay results are propagated back to parent layer.</p>
</div>
<div class="col">
<h3>Navigation intent</h3>
<p>Not every fragment update means a user navigation.
Switching screens need other defaults than updating a box.</p>
<h3>Accessibility</h3>
<p>All Unpoly features carefully manage focus.
Keyboard navigation is supported everywhere.</p>
<h3>Quality of live improvements</h3>
<p>Extensive rework of almost all APIs.</p>
</div>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="5" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> <strong>Learnings from past projects</strong></p>
<p><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> <strong>Pro features (separate session in January)</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="6" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Changes ahead, but don't panic!</h1>
<p>You will see some major changes in these slides, but <strong>don't panic</strong>!<br />
Unpoly 2 keeps aliases for deprecated APIs going back to 2016.</p>
<p>Calls to old APIs will be forwarded to the new version and log a deprecation notice with a trace.<br />
This way you upgrade Unpoly, revive your application with few changes, then replace old API calls under green tests.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="7" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<div class="row">
<div class="col">
<h3>Renamed events are aliased</h3>
<p><code>up.on('up:proxy:load')</code> will bind to<br />
<code>up:request:load</code>.</p>
<h3>Renamed functions are aliased</h3>
<p><code>up.modal.close()</code> will call<br />
<code>up.layer.dismiss()</code></p>
<h3>Renamed options are aliased</h3>
<p><code>{ reveal: false }</code> will be renamed to<br />
<code>{ scroll: false }</code></p>
</div>
<div class="col">
<h3>Renamed modules are aliased</h3>
<p><code>up.proxy.config</code> will return<br />
<code>up.network.config</code>.</p>
<h3>Renamed HTML attributes are aliased</h3>
<p><code>&lt;a up-close&gt;</code> will translate to<br />
<code>&lt;a up-dismiss&gt;</code>.</p>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="8" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Kill boilerplate configuration</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="9" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Delete your link helpers</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Our projects need too much code to configure Unpoly.</strong></p>
<p>All our projects have helpers like <code>content_link()</code> and <code>modal_link()</code> to configure defaults:</p>
<ul>
<li>Make a link followable through Unpoly</li>
<li>Accelerate clicks with <code>[up-preload]</code> and <code>[up-instant]</code></li>
<li>Set a default target</li>
<li>Set a transition (sometimes)</li>
</ul>
<p><strong>In Unpoly 2 these helpers (and their macros) are no longer needed.</strong></p>
<p>You can configure Unpoly 2 to handle standard <code>&lt;a href&gt;</code> links without any <code>[up-...]</code> attributes.</p>
<p>Rails users can now use the standard <code>link_to()</code> helper without extra options.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="10" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Following all links by default</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Most apps handle all links and forms through Unpoly.</strong></p>
<p>Unpoly 1 forced apps to manually opt-in every link and form.</p>
<p>You can tell Unpoly 2 to handle <strong>all</strong> links and forms:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.link.config.followSelectors.push(<span class="hljs-string">&#x27;a&#x27;</span>)
up.form.config.submitSelectors.push(<span class="hljs-string">&#x27;form&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
<p>Links will now be followed through Unpoly <strong>without</strong> an <code>[up-target]</code> or <code>[up-follow]</code> attribute:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/backend&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="11" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Making exceptions</h2>
<p>You may still opt out individual links or forms by setting <code>[up-follow=false]</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/backend&quot;</span> <span class="hljs-attr">up-follow</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>To except <em>all</em> external links and forms, skip URL with a schema separator (<code>://</code>):</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.link.config.followSelectors.push(<span class="hljs-string">&#x27;a:not(href*=&quot;://&quot;)&#x27;</span>)
up.form.config.submitSelectors.push(<span class="hljs-string">&#x27;form:not(action*=&quot;://&quot;)&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="12" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Accelerating links by default</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Most links should activate on <code>mousedown</code>  and be preloaded.</strong></p>
<p>If you want to default to <code>[up-instant]</code> and <code>[up-preload]</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.link.config.instantSelectors.push(<span class="hljs-string">&#x27;a&#x27;</span>)
up.link.config.preloadSelectors.push(<span class="hljs-string">&#x27;a&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
<p>All your links now activate on <code>mousedown</code> and (with a <code>GET</code> method) preload on <code>mouseover</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/backend&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="13" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Making exceptions</h2>
<p>Instant clicks feel wrong for buttons. To cover that, configure a CSS selector that excludes buttons:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.link.config.instant.push(<span class="hljs-string">&#x27;a:not(.button)&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
<p>Individual links may opt out by setting <code>[up-instant=false]</code> or <code>[up-preload=false]</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/backend&quot;</span> <span class="hljs-attr">up-instant</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/expensive-path&quot;</span> <span class="hljs-attr">up-preload</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="14" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Main targets</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Many links simply replace the main content element.</strong></p>
<p>Unpoly 1 required you to pass a target selector with every fragment update, although it would often be the same selector.</p>
<p>Unpoly 2 lets you mark elements as default targets using the <code>[up-main]</code> attribute:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout--side&quot;</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout--content&quot;</span> <span class="hljs-attr">up-main</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="15" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Look ma, no target!</h2>
<p>Once a main target is configured, you no longer need <code>[up-target]</code> in a link.<br />
Use <code>[up-follow]</code> and the <code>[up-main]</code> element will be replaced:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/foo&quot;</span> <span class="hljs-attr">up-follow</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>If you want to update something more specific, you can still use <code>[up-target]</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/foo&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.profile&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>Instead of assigning <code>[up-main]</code> you may also configure an existing selector:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.fragment.config.mainTargets.push(<span class="hljs-string">&#x27;.layout--content&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="16" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Overlays can use different main targets</h2>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Overlays often use a different main selector, e.g. to exclude a navigation bar.</strong></p>
<p>Unpoly 2 lets you configure different main targets for different layer modes:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout&quot;</span> <span class="hljs-attr">up-main</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout--side&quot;</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;layout--content&quot;</span> <span class="hljs-attr">up-main</span>=<span class="hljs-string">&quot;overlay&quot;</span>&gt;</span>
      ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>You may also configure overlay targets unobtrusively:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.config.popup.targets.push(<span class="hljs-string">&#x27;.menu&#x27;</span>)              <span class="hljs-comment">// for popup overlays</span>
up.layer.config.drawer.targets.push(<span class="hljs-string">&#x27;.menu&#x27;</span>)             <span class="hljs-comment">// for drawer overlays</span>
up.layer.config.overlay.targets.push(<span class="hljs-string">&#x27;.layout--content&#x27;</span>) <span class="hljs-comment">// for all overlay modes</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="17" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Setting a default transition</h1>
<p>I'm not a big fan of animating <em>every</em> fragment update.</p>
<p><strong>But since some of you do this</strong>, here is how to set a default transition:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.fragment.config.navigateOptions.transition = <span class="hljs-string">&#x27;cross-fade&#x27;</span>
</span></span></foreignObject></svg></code></pre>
<p>We're going to learn more about <code>up.fragment.config.navigateOptions</code> in a minute.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="18" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Reworked Boostrap integration</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Many projects didn't use built-in Bootstrap integration, because it was too opinionated.</strong></p>
<p>For example, Unpoly tried to re-use the Bootstrap modal styles, but most projects simply wanted the white box from the Unpoly default. Projects ended up using their own configuration, which was much more minimal.</p>
<p>Unpoly 2 now ships with a <strong>unopinionated Bootstrap integration</strong>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="19" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>This is all of <code>unpoly-boostrap4.js</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Bootstrap expects the class .active instead of .up-active</span>
up.feedback.config.currentClasses.push(<span class="hljs-string">&#x27;active&#x27;</span>)

<span class="hljs-comment">// Set .up-current classes in Bootstrap navigation components</span>
up.feedback.config.navs.push(<span class="hljs-string">&#x27;.nav&#x27;</span>, <span class="hljs-string">&#x27;.navbar&#x27;</span>)

<span class="hljs-comment">// When validating, update the closest form group with the results</span>
up.form.config.validateTargets.unshift(<span class="hljs-string">&#x27;.form-group:has(&amp;)&#x27;</span>)

<span class="hljs-comment">// When revealing, scroll far enough so content is not covered by</span>
<span class="hljs-comment">// fixed Bootstrap bars</span>
up.viewport.config.fixedTop.push(<span class="hljs-string">&#x27;.navbar.fixed-top&#x27;</span>)
up.viewport.config.fixedBottom.push(<span class="hljs-string">&#x27;.navbar.fixed-bottom&#x27;</span>)
up.viewport.config.anchoredRight.push(<span class="hljs-string">&#x27;.navbar.fixed-top&#x27;</span>, <span class="hljs-string">&#x27;.navbar.fixed-bottom&#x27;</span>)

<span class="hljs-comment">/// Don&#x27;t use common utility classes to build selectors</span>
up.fragment.config.badTargetClasses.push(
  <span class="hljs-string">&#x27;row&#x27;</span>,
  <span class="hljs-regexp">/^col(-xs|-sm|-md|-lg|-xl)?(-\d+)?$/</span>,
  <span class="hljs-regexp">/^[mp][tblrxy]?-\d+$/</span>
)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="20" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>This is all of <code>unpoly-bootstrap4.scss</code>:</p>
<pre><code class="language-css"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">/* If a Boostrap container is shown in an overlay,
   don&#x27;t add to the existing padding of the overlay box. */</span>
<span class="hljs-selector-tag">up-modal</span>, <span class="hljs-selector-tag">up-drawer</span>, <span class="hljs-selector-tag">up-popup</span> {
  .container, .container-fluid {
    <span class="hljs-attribute">padding-left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0</span>;
  }
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="21" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Support for Bootstrap 3, 4 and 5</h2>
<p>Unpoly 2 now supports the three major Bootstrap versions we're using:</p>
<ul>
<li><code>unpoly-bootstrap3.js</code></li>
<li><code>unpoly-bootstrap3.css</code></li>
<li><code>unpoly-bootstrap4.js</code></li>
<li><code>unpoly-bootstrap4.css</code></li>
<li><code>unpoly-bootstrap5.js</code></li>
<li><code>unpoly-bootstrap5.css</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="22" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Layer API</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="23" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Demo of new layer implementation</h1>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Show demo:</em></p>
<ul>
<li><em>Show infinite stacking</em></li>
<li><em>Show returning with value</em></li>
<li><em>Show isolation</em></li>
</ul>
<p>TODO: Fill demo database with factory data</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="24" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>New layer terminology</h1>
<p>The root page, modals and popups have been consolidated into a single term <em>layer</em>.</p>
<p>There are different layer <em>modes</em>, e.g. <code>modal</code> or <code>popup</code>.</p>
<p>An <em>overlay</em> is any layer that is not the root layer.</p>
<br />
<table>
<thead>
<tr>
<th>Mode</th>
<th>Description</th>
<th>Overlay?</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>root</code></td>
<td>The root page</td>
<td>no</td>
</tr>
<tr>
<td><code>modal</code></td>
<td>A modal dialog box</td>
<td>yes</td>
</tr>
<tr>
<td><code>drawer</code></td>
<td>A drawer sliding in from the side</td>
<td>yes</td>
</tr>
<tr>
<td><code>popup</code></td>
<td>A popup menu anchored to a link</td>
<td>yes</td>
</tr>
<tr>
<td><code>cover</code> <img class="emoji" draggable="false" alt="âœ¨" src="https://twemoji.maxcdn.com/2/svg/2728.svg" data-marp-twemoji=""/></td>
<td>Covers entire screen</td>
<td>yes</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="25" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Layers are fully isolated</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> In Unpoly 1 you could accidentally update another layer.</strong></p>
<p>In Unpoly 2 layers are fully isolated. You cannot accidentally target an element in another layer:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.foo&quot;</span>&gt;</span> <span class="hljs-comment">&lt;!-- will only match in current layer --&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>If you want to do <em>anything</em> in another layer, use an <code>[up-layer]</code> attribute:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.foo&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;parent&quot;</span>&gt;</span> <span class="hljs-comment">&lt;!-- will only match in parent layer --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.foo&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span>   <span class="hljs-comment">&lt;!-- will only match in root layer --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.foo&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!-- opens a new modal overlay --&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>You can always look at <code>[up-layer]</code> to know what layer is going to be updated.<br />
If there is no <code>[up-layer]</code> attribute, you are going to update the current layer.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="26" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>CSS selectors are resolved in the current layer</h1>
<p>JavaScript functions that take a CSS selector will only look in the current layer:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.submit(<span class="hljs-string">&#x27;.user-form&#x27;</span>) <span class="hljs-comment">// will only find in the current layer</span>
up.fragment.get(<span class="hljs-string">&#x27;.foo&#x27;</span>) <span class="hljs-comment">// will only find in the current layer</span>
</span></span></foreignObject></svg></code></pre>
<p>If you want to resolve a selector in another layer, use a <code>{ layer }</code> option:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.fragment.get(<span class="hljs-string">&#x27;.first&#x27;</span>, { <span class="hljs-attr">layer</span>: <span class="hljs-string">&#x27;any&#x27;</span> })    <span class="hljs-comment">// will find in any layer</span>
up.fragment.get(<span class="hljs-string">&#x27;.first&#x27;</span>, { <span class="hljs-attr">layer</span>: <span class="hljs-string">&#x27;parent&#x27;</span> }) <span class="hljs-comment">// will find in parent layer</span>
</span></span></foreignObject></svg></code></pre>
<p>You don't need a <code>{ layer }</code> option when you pass DOM elements instead of selectors:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.submit(form) <span class="hljs-comment">// will submit the form in the form&#x27;s layer</span>
up.fragment.get(element, <span class="hljs-string">&#x27;.child&#x27;</span>) <span class="hljs-comment">// will find .child in element&#x27;s descendants</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="27" data-class="no-watermark" data-theme="unpoly2-slides" class="no-watermark" style="--class:no-watermark;--theme:unpoly2-slides;">
<h2><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Referring to layers</h2>
<div class="row">
<div class="col">
<table>
<thead>
<tr>
<th>LayerÂ name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>current</code></td>
<td>The current layer</td>
</tr>
<tr>
<td><code>any</code></td>
<td>Any layer, preferring the current layer</td>
</tr>
<tr>
<td><code>parent</code></td>
<td>The layer that opened the current layer</td>
</tr>
<tr>
<td><code>closest</code></td>
<td>The current layer or any ancestor, preferring closer layers</td>
</tr>
<tr>
<td><code>root</code></td>
<td>The root layer</td>
</tr>
<tr>
<td><code>overlay</code></td>
<td>Any overlay</td>
</tr>
<tr>
<td><code>origin</code></td>
<td>The layer of the element that triggered the current action</td>
</tr>
</tbody>
</table>
</div>
<div class="col">
<table>
<thead>
<tr>
<th>Layer name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ancestor</code></td>
<td>Any ancestor layer of the current layer</td>
</tr>
<tr>
<td><code>child</code></td>
<td>The child layer of the current layer</td>
</tr>
<tr>
<td><code>descendant</code></td>
<td>Any descendant of the current layer</td>
</tr>
<tr>
<td><code>ElementÂ object</code></td>
<td>The given element's layer</td>
</tr>
<tr>
<td><code>currentÂ root</code></td>
<td>Space-separated alternatives</td>
</tr>
<tr>
<td><code>front</code></td>
<td>The frontmost layer (which may not be the current layer)</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="28" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Layers can be stacked infinitely</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> In Unpoly 1 you could only stack two screens.
This limited its practical applications.</strong></p>
<p>Example from a real application:</p>
<ul>
<li>The root page shows a list of record</li>
<li>Clicking a record opens a record in a modal overlay. This is useful since the user retains the scroll position of the list in the background.</li>
<li>The details screen cannot open another modal overlay, since one is already open.</li>
</ul>
<p><strong>Unpoly 2 lets you stack an arbitrary number of screens.</strong></p>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Show demo</em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="29" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Most events are associated with a layer</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Layers are rarely interested in events of other layers.</strong></p>
<p>Where possible Unpoly will emit its events on associated layers instead of <code>document</code>.<br />
This way you can listen to events on one layer without receiving events from other layers.</p>
<p>Events resulting from user navigation (like <code>up:link:follow</code>, <code>up:request:load</code>) are associated with the layer of the activated element.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="30" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>Unpoly provides convenience functions <code>up.layer.on()</code>  and <code>up.layer.emit()</code> to listen / emit on the current layer:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.on(<span class="hljs-string">&#x27;up:request:load&#x27;</span>, callback) <span class="hljs-comment">// only listen to events from the current layer</span>
up.layer.emit(<span class="hljs-string">&#x27;may:event&#x27;</span>) <span class="hljs-comment">// emit my:event on the current layer&#x27;s element</span>
</span></span></foreignObject></svg></code></pre>
<p>Layer events will still bubble up to the <code>document</code>, so you can still register
a listener for events from any layer:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.on(<span class="hljs-string">&#x27;up:request:load&#x27;</span>, callback) <span class="hljs-comment">// listen to events from all layers</span>
up.emit(<span class="hljs-string">&#x27;my:event&#x27;</span>) <span class="hljs-comment">// emit my:event on document</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="31" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Sub-interactions</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="32" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Why we need sub-interactions</h1>
<p>This story is the base use case for a sub-interaction:</p>
<ul>
<li>User starts filling out the form for a new project</li>
<li>To create a project, the user must select a company. But the desired company does not yet exist.</li>
<li>The user may open a new overlay to create the missing company.<br />
The unfinished project form remains open in the background.</li>
<li>When the company was created in the overlay, the overlay should close.<br />
The project form should now have the newly created company selected.</li>
</ul>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Show scenario in the demo</em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="33" data-class="align-top" data-theme="unpoly2-slides" class="align-top" style="--class:align-top;--theme:unpoly2-slides;">
<h2>Flow without layers</h2>
<pre><code><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>+------------+     +----------------------------+     +-----------------+
|            |     |                            |     |                 |
|  List      |     |  New                       |     |  Show           |
|  projects  +-----&gt;  project                   +-----&gt;  project        |
|            |     |                            |     |                 |
+------------+     +-----+----------------^-----+     +-----------------+
                         |                |
                         |                |
                   +-----v-----+    +-----+-----+
                   |           |    |           |
                   |  New      |    |  Create   |
                   |  company  +----&gt;  company  |
                   |           |    |           |
                   +-----------+    +-----------+
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="34" data-class="align-top" data-theme="unpoly2-slides" class="align-top" style="--class:align-top;--theme:unpoly2-slides;">
<h2>Flow with layers</h2>
<pre><code><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>+------------+     +-----------------------------+     +-----------------+
|            |     |                             |     |                 |
|  List      |     |  New            (new option |     |  Show           |
|  projects  +-----&gt;  project         in select) +-----&gt;  project        |
|            |     |                             |     |                 |
+------------+     +-----+-----------------^-----+     +-----------------+
                         |                 |
              &quot;oh, missing company&quot;  {companyID: 123}
                         |                 |
                   +-----v-----+     +-----+-----+
                   |           |     |           |
                   |  New      |     |  Create   |
                   |  company  +-----&gt;  company  |
                   |           |     |           |
                   +-----------+     +-----------+
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="35" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Unpoly 1 modals didn't work well for this</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Unpoly 1 hade no way to communicate the &quot;result&quot; of an overlay back to the parent layer.</strong></p>
<p>Overlay content needed to update fragments in the parent layer to continue the story there.
This required the overlay to know the parent layer's state, <em>coupling</em> the sub-interaction to the parent interaction.</p>
<p>In Unpoly 2 overlays no longer need to know about the parent layer's state.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="36" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Acceptance conditions in Unpoly 2</h1>
<p><strong>When opening an overlay in Unpoly 2, you may define a <em>condition</em> when the overlay interaction ends.</strong></p>
<p>When the condition occurs, the overlay is automatically closed and a callback is run.</p>
<p>This completely <em>decouples</em> the outer interaction from sub-interactions.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="37" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Overlay result values</h1>
<p>Overlays in Unpoly 2 may have a <em>result value</em>.</p>
<p>E.g. if the user selects a value, we consider the overlay to be &quot;accepted&quot; with that value.</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open({
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/select-user&#x27;</span>,
  <span class="hljs-attr">onAccepted</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&#x27;Got user &#x27;</span>, event.user)
})
</span></span></foreignObject></svg></code></pre>
<p>The following slides examine how an overlay can be &quot;accepted&quot;.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="38" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Accepting when a location is reached</h1>
<p>The following will open an overlay that closes once a URL like <code>/companies/123</code> is reached:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/companies/new&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-accept-location</span>=<span class="hljs-string">&quot;/companies/$id&quot;</span>
  <span class="hljs-attr">up-on-accepted</span>=<span class="hljs-string">&quot;alert(&#x27;New company with ID &#x27; + value.id)&quot;</span>&gt;</span>
  New company
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>Placeholders in the URL pattern (<code>$id</code>) become the overlay's <em>acceptance value</em>.</p>
<p>The <code>[up-on-accepted]</code> callback is called with an acceptance value.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="39" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>A <strong>common callback</strong> is to reload an element in the parent layer:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/companies/new&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-accept-location</span>=<span class="hljs-string">&quot;/companies/$id&quot;</span>
  <span class="hljs-attr">up-on-accepted</span>=<span class="hljs-string">&quot;up.reload(&#x27;.company-list&#x27;)&quot;</span>&gt;</span>
  New company
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;company-list&quot;</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="40" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p><strong>Another common callback</strong> reloads <code>&lt;select&gt;</code> options and selects the new foreign key:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;company&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/companies/new&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-accept-location</span>=<span class="hljs-string">&quot;/companies/$id&quot;</span>
  <span class="hljs-attr">up-on-accepted</span>=<span class="hljs-string">&quot;up.validate(&#x27;select&#x27;, { params: { company: value.id } })&quot;</span>&gt;</span>
  New company
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="41" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Why I think this is useful</h2>
<ul>
<li>You already have a CRUD interaction for users</li>
<li>You can now embed the existing user CRUD into your company form</li>
<li>The embedded interaction does not need to know when it's &quot;done&quot; or
what to do when it's done. Instead the parent layer defines an
acceptance condition and callback action.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="42" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Accepting when an event is emitted</h1>
<p>You may also accept an overlay once a given event is observed on the overlay:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/users/new&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-accept-event</span>=<span class="hljs-string">&quot;user:created&quot;</span>
  <span class="hljs-attr">up-on-accepted</span>=<span class="hljs-string">&quot;alert(&#x27;Hello user #&#x27; + value.id)&quot;</span>&gt;</span>
  Add a user
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>The event object becomes the overlay's acceptance value:</p>
<p>Your frontend code may use <code>up.layer.emit()</code> to emit an event on the current layer element:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.emit(<span class="hljs-string">&#x27;user:created&#x27;</span>, { <span class="hljs-attr">id</span>: <span class="hljs-number">123</span>})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="43" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Emitting events from the server</h2>
<p>In a server-side application, events often occur on the server.</p>
<p>In Unpoly 2 the server can also emit events:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersController</span> &lt; ApplicationController</span>
  ...

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    build_user
    <span class="hljs-keyword">if</span> <span class="hljs-variable">@user</span>.save
      up.layer.emit(<span class="hljs-string">&#x27;user:created&#x27;</span>, <span class="hljs-symbol">id:</span> <span class="hljs-variable">@user</span>.id)
      redirect_to <span class="hljs-variable">@user</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
<p>The server-sent event is emitted on the updated layer.<br />
To emit on the <code>document</code>, use <code>up.emit()</code> instead.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="44" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Accepting a layer explictly</h1>
<p>If you want to be <em>really direct</em>, give a link an <code>[up-accept]</code> attribute.<br />
The link's overlay will be closed when the link is clicked:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;/users/5&#x27;</span> <span class="hljs-attr">up-accept</span>=<span class="hljs-string">&#x27;{ &quot;id&quot;: 5 }&#x27;</span>&gt;</span>Choose user #5<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>The JSON value of the <code>[up-accept]</code> attribute becomes the overlay's acceptance value.</p>
<p>The link will only be followed if the link is on the root layer (where there is no overlay to accept).</p>
<p>I'm not a big fan of this because it couples the overlay interaction to its parent layer.<br />
But some of you asked for it, and I guess sometimes the overlay cannot be separated
from its parent.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="45" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Accepting from the server</h2>
<p>Server may also accept an overlay explicitly:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UsersController</span> &lt; ApplicationController</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    build_user
    <span class="hljs-keyword">if</span> <span class="hljs-variable">@user</span>.save
      <span class="hljs-keyword">if</span> up.overlay?
        up.layer.accept(<span class="hljs-symbol">id:</span> <span class="hljs-variable">@user</span>.id)
        up.render_nothing
      <span class="hljs-keyword">else</span>
        redirect_to <span class="hljs-variable">@user</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>

  ...
<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="46" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Positive vs. negative close intent</h1>
<p>We've seen examples where an overlay was closed with a value.<br />
But what happens if the user presses Escape or clicks &quot;X&quot;?</p>
<p>For this Unpoly 2 distinguishes two kinds close intents:</p>
<ol>
<li><em>Accepting</em> a layer (user picks a value, confirms with &quot;OK&quot;, etc.), optionally with a value</li>
<li><em>Dismissing</em> a layer (user clicks &quot;Cancel&quot;, &quot;X&quot;, &quot;Close&quot; or presses the ESC key)</li>
</ol>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="47" data-class="no-watermark" data-theme="unpoly2-slides" class="no-watermark" style="--class:no-watermark;--theme:unpoly2-slides;"><pre><code><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>+-------------------------------+
| Select a company          [X]-+---&gt; dismiss()
+-------------------------------+
|                               |
|  +-------------------------+  |
|  [ Foo Corp ]               +------&gt; accept('Foo Corp')
|  +-------------------------+  |
|                               |
|  +-------------------------+  |
|  | Bar GmbH                +------&gt; accept('Bar GmbH')
|  +-------------------------+  |
|                               |
|  +-------------------------+  |
|  | Baz AG                  +------&gt; accept('Baz AG')
|  +-------------------------+  |
|                               |
+-------------------------------+
|                      [CANCEL]-+---&gt; dismiss()
+-------------------------------+

                Click on backdrop:    dismiss()
 
                         ESC key:     dismiss()
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="48" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Dismissal is cancelation</h2>
<p>When you're waiting for a sub-interaction to finish successfully,
you're probably only interested in layer acceptance, but not dismissal.</p>
<p>When opening a layer you may pass separate <code>{ onAccepted }</code> and <code>{ onDismissed }</code>  callbacks:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open({
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/users/new&#x27;</span>,
  <span class="hljs-attr">onAccepted</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;New user is &quot;</span> + event.value),
  <span class="hljs-attr">onDismissed</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;User creation was canceled&quot;</span>)
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="49" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Overlays are promises</h1>
<p>You can think of overlays as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">promises</a>
which may either be<br />
<strong>fulfilledÂ (accepted)</strong> or <strong>rejectedÂ (dismissed)</strong>.</p>
<p>Instead of using <code>up.layer.open()</code> and passing callbacks, you may use <code>up.layer.ask()</code>.<br />
The later returns a promise for the acceptance value:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> up.layer.ask({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/users/new&#x27;</span> })
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;New user is &quot;</span> + user)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="50" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Layer context</h1>
<p>The web platform gives you several tools to persist state across requests,<br />
like cookies or session storage.</p>
<p>But with overlays you need to store state <em>per layer</em>.</p>
<p>Unpoly adds <em>layer context</em>, a key/value store that exists for
the lifetime of a layer:</p>
<table>
<thead>
<tr>
<th>Store</th>
<th>Scope</th>
<th>Persistence</th>
<th>Values</th>
<th>Client-manageable</th>
<th>Server-manageable</th>
</tr>
</thead>
<tbody>
<tr>
<td>Local storage</td>
<td>Domain</td>
<td>Permanentish</td>
<td>String</td>
<td>Yes</td>
<td>â€“</td>
</tr>
<tr>
<td>Cookies</td>
<td>Domain</td>
<td>Configurable</td>
<td>String</td>
<td>Configurable</td>
<td>Yes</td>
</tr>
<tr>
<td>Session storage</td>
<td>Tab</td>
<td>Session</td>
<td>String</td>
<td>Yes</td>
<td>â€“</td>
</tr>
<tr>
<td>Layer context <img class="emoji" draggable="false" alt="ðŸ†•" src="https://twemoji.maxcdn.com/2/svg/1f195.svg" data-marp-twemoji=""/></td>
<td>Layer</td>
<td>Session</td>
<td>JSON</td>
<td>Yes</td>
<td>Yes</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="51" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Initializing the context object</h2>
<p>The default context is an empty object (<code>{}</code>).</p>
<p>You may initialize the context object when opening a layer:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/games/new&#x27;</span>, <span class="hljs-attr">context</span>: { <span class="hljs-attr">lives</span>: <span class="hljs-number">3</span> } })
</span></span></foreignObject></svg></code></pre>
<p>Or from HTML:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;/games/new&#x27;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&#x27;new&#x27;</span> <span class="hljs-attr">up-context</span>=<span class="hljs-string">&#x27;{ &quot;lives&quot;: 3 }&#x27;</span>&gt;</span>
  Start a new game
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="52" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Working with the context object</h2>
<p>You may read and change the context from your client-side JavaScript:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.on(<span class="hljs-string">&#x27;heart:collected&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  up.context.lives++
})
</span></span></foreignObject></svg></code></pre>
<p>You may read and change the context from the server:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GamesController</span> &lt; ApplicationController</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">restart</span></span>
    up.context[<span class="hljs-symbol">:lives</span>] = <span class="hljs-number">3</span>
    render <span class="hljs-string">&#x27;stage1&#x27;</span>
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="53" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Use case: Re-using interactions in an overlay, but with a variation</h2>
<p>Context is useful when you want to re-use an existing interaction in an overlay, but make a slight variation.</p>
<ul>
<li>Assume you want to re-use your existing contacts index for a contact picker widget.</li>
<li>The contact picker opens the context index in an overlay where the user can choose a contact.</li>
<li>In this case the contact index should show an additional message &quot;Pick a context for project Foo&quot;, replacing <code>Foo</code> with the actual name of the project.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="54" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>We can implement such an contact picker with this ERB template:</p>
<pre><code class="language-erb"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="xml">&lt;%</span><span class="ruby"> form_for <span class="hljs-variable">@project</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|form|</span> </span><span class="xml">%&gt;

  Contact: &lt;%=</span><span class="ruby"> form.object.contact </span><span class="xml">%&gt;

  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;/contacts&#x27;</span>
    <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&#x27;new&#x27;</span>
    <span class="hljs-attr">up-accept-location</span>=<span class="hljs-string">&#x27;/contacts/*&#x27;</span>
    <span class="hljs-attr">up-context</span>=<span class="hljs-string">&#x27;&lt;%=</span></span></span><span class="ruby"> { <span class="hljs-symbol">project:</span> <span class="hljs-variable">@project</span>.name }.to_json </span><span class="xml"><span class="hljs-tag"><span class="hljs-string">%&gt;&#x27;</span>&gt;</span>
    Pick a contact
  <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

  ...
&lt;%</span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml">%&gt;
</span></span></span></foreignObject></svg></code></pre>
<p>Our effective contact object would now be something like <code>{ project: 'Hosting 2021' }</code>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="55" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>The server can inspect the context in <code>/contacts/index.erb</code>:</p>
<pre><code class="language-erb"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="xml">&lt;%</span><span class="ruby"> <span class="hljs-keyword">if</span> up.context[<span class="hljs-symbol">:project</span>] </span><span class="xml">%&gt;
  Pick a contact for &lt;%=</span><span class="ruby"> up.context[<span class="hljs-symbol">:project</span>] </span><span class="xml">%&gt;:
&lt;%</span><span class="ruby"> <span class="hljs-keyword">else</span> </span><span class="xml">%&gt;  
  List of contacts
&lt;%</span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml">%&gt;

&lt;%</span><span class="ruby"> <span class="hljs-variable">@contacts</span>.each <span class="hljs-keyword">do</span> <span class="hljs-params">|contact|</span> </span><span class="xml">%&gt;
  <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
&lt;%</span><span class="ruby"> <span class="hljs-keyword">end</span> </span><span class="xml">%&gt;  
</span></span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="56" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Remembering the current layer</h1>
<p>Like most functions, <code>up.layer.dismiss()</code> will affect the &quot;current&quot; layer.</p>
<p><code>up.layer.current</code> is set to the right layer in compilers and most events, even if that layer is not the &quot;front&quot; layer. E.g. if you're compiling a fragment for a background layer, <code>up.layer.current</code> will be
the background layer during compilation.</p>
<p>If you have async code, the current layer may change when your callback is called.<br />
You may also retrieve the current layer for later reference:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dismissCurrentIn</span>(<span class="hljs-params">seconds</span>) </span>{
  <span class="hljs-keyword">let</span> savedLayer = up.layer.current <span class="hljs-comment">// returns an up.Layer object</span>
  <span class="hljs-keyword">let</span> dismiss = <span class="hljs-function">() =&gt;</span> savedLayer.dismiss()
  <span class="hljs-built_in">setTimeout</span>(dismiss, seconds * <span class="hljs-number">1000</span>)
}

dismissCurrentIn(<span class="hljs-number">10</span>) <span class="hljs-comment">// </span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="57" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>New overlay HTML structure</h1>
<p>Unpoly 2 uses different HTML markup for its overlays. If you have customized your modals and popup with CSS, this is a breaking change for you.</p>
<p>Luckily the new HTML structure is very similiar. E.g. <code>&lt;div class=&quot;modal&quot;&gt;</code> becomes <code>&lt;up-modal&gt;</code>.</p>
<div class="row">
<div class="col">
<h2>Old modal HTML</h2>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;up-modal&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;up-modal-viewport&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;up-modal-dialog&quot;</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;up-modal-content&quot;</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;up-modal-dismiss&quot;</span>&gt;</span>Ã—<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</div>
<div class="col">
<h2>New modal HTML</h2>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">up-modal</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">up-modal-viewport</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">up-modal-box</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">up-modal-content</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">up-modal-dismiss</span>&gt;</span>Ã—<span class="hljs-tag">&lt;/<span class="hljs-name">up-modal-dismiss</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">up-modal-box</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">up-modal-viewport</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">up-modal</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</div>
</div>
<p>The HTML of other overlay modes was changed in the same way.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="58" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Customizing overlays with CSS</h1>
<p>If you have modified the appearance with CSS, you need to update your selectors.</p>
<h3>Old CSS</h3>
<pre><code class="language-css"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-selector-class">.up-popup-content</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eeeeee</span>;
}
</span></span></foreignObject></svg></code></pre>
<h3>New CSS</h3>
<pre><code class="language-css"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-selector-tag">up-popup-content</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#eeeeee</span>;
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="59" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Overlay classes</h1>
<p>You can assign a class to the overlay you're opening.</p>
<div class="row">
<div class="col">
<h3>JavaScript</h3>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open({
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/confirm-erase&#x27;</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;delete&#x27;</span>,
  <span class="hljs-attr">class</span>: <span class="hljs-string">&#x27;warning&#x27;</span>
})
</span></span></foreignObject></svg></code></pre>
</div>
<div class="col">
<h3>HTML</h3>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/confirm-erase&quot;</span>
  <span class="hljs-attr">up-method</span>=<span class="hljs-string">&quot;delete&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-class</span>=<span class="hljs-string">&quot;warning&quot;</span>&gt;</span>
  Erase disk
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</div>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="60" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>The class will be assigned to the layer element:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">up-modal</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;warning&quot;</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">up-modal</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>You can now style &quot;warning modals&quot; in your CSS:</p>
<pre><code class="language-css"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-selector-tag">up-modal</span><span class="hljs-selector-class">.warning</span> <span class="hljs-selector-tag">up-modal-box</span> {
  <span class="hljs-attribute">background-color</span>: yellow
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="61" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Overlay sizes</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> In Unpoly 1, overlays grew with the size of the content.
This was impractical because a single long line of text would stretch the overlay to its maximum width.</strong></p>
<p>Because of this most projects have configured modals to have a fixed size.
Many projects also have hacks to open modals with different sizes.</p>
<p>In Unpoly 2 all overlays have a given size that sets a maximum width:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span> <span class="hljs-attr">up-size</span>=<span class="hljs-string">&quot;small&quot;</span>&gt;</span>open small modal<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span> <span class="hljs-attr">up-size</span>=<span class="hljs-string">&quot;medium&quot;</span>&gt;</span>open medium modal<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span> <span class="hljs-attr">up-size</span>=<span class="hljs-string">&quot;large&quot;</span>&gt;</span>open large modal<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="62" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Default sizes</h2>
<table>
<thead>
<tr>
<th style="text-align:right">Mode</th>
<th style="text-align:right">small</th>
<th style="text-align:right">medium</th>
<th style="text-align:right">large</th>
<th>auto</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"><code>modal</code></td>
<td style="text-align:right"><code>350px</code></td>
<td style="text-align:right"><code>650px</code></td>
<td style="text-align:right"><code>1000px</code></td>
<td>grow  with content</td>
</tr>
<tr>
<td style="text-align:right"><code>popup</code></td>
<td style="text-align:right"><code>180px</code></td>
<td style="text-align:right"><code>300px</code></td>
<td style="text-align:right"><code>550px</code></td>
<td>grow  with content</td>
</tr>
<tr>
<td style="text-align:right"><code>drawer</code></td>
<td style="text-align:right"><code>150px</code></td>
<td style="text-align:right"><code>340px</code></td>
<td style="text-align:right"><code>600px</code></td>
<td>grow  with content</td>
</tr>
<tr>
<td style="text-align:right"><code>cover</code></td>
<td style="text-align:right"><code>100%</code></td>
<td style="text-align:right"><code>100%</code></td>
<td style="text-align:right"><code>100%</code></td>
<td><code>100%</code></td>
</tr>
</tbody>
</table>
<p>These are generally wider than Bootstrap's counterparts.</p>
<p>Regardless of size, overlays never grow wider than the screen width.</p>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Show demo</em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="63" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Customizing overlay sizes</h2>
<p>You can customize sizes with CSS:</p>
<pre><code class="language-css"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-selector-tag">up-modal</span><span class="hljs-selector-attr">[size=medium]</span> <span class="hljs-selector-tag">up-modal-box</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="64" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Dismissability can be fine-tuned</h1>
<p>In Unpoly 1 you could prevent a user from closing a layer with the <code>{ closable: false }</code> option.</p>
<p>In Unpoly 2 you may choose which closing methods are available to the user:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Effect</th>
<th>Dismiss value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{ keyDismissable }</code></td>
<td>Enables dimissing with escape key</td>
<td><code>:key</code></td>
</tr>
<tr>
<td><code>{ outsideDismissable }</code></td>
<td>Enables dismissing by clicking on the background</td>
<td><code>:outside</code></td>
</tr>
<tr>
<td><code>{ buttonDismissable }</code></td>
<td>Adds an &quot;X&quot; button to the layer</td>
<td><code>:button</code></td>
</tr>
</tbody>
</table>
<p>You may also enable or disable <em>all</em> closing methods together with the <code>{ dismissable }</code> option.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="65" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Customizing overlay HTML</h1>
<p>The HTML markup for a given overlay mode is now static. There is no <code>up.modal.config.template</code> anymore.</p>
<p>Many former use cases for <code>up.modal.config.template</code> are covered by assigning a class, size.</p>
<p>If you absolutely, positively need to customize the overlay HTML, you may use the <code>up:layer:opened</code> event to modify the layer as it becomes visible. The event is emitted
before the opening animation starts.</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">if</span> (isChristmas()) {
  up.on(<span class="hljs-string">&#x27;up:layer:opened&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
    up.element.affix(event.layer.element, <span class="hljs-string">&#x27;.santa-hat&#x27;</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;Merry Christmas!&#x27;</span>)
  })
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="66" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Drawers and modal &quot;flavors&quot;</h1>
<p>Drawer overlays used to be a modal &quot;flavor&quot; in Unpoly 1. They shared their HTML markup with
standard modal overlays.</p>
<p>There is no <code>up.modal.flavors</code> in Unpoly 2 anymore. Drawers are now a first-class overlay
mode with their own <code>&lt;up-drawer&gt;</code> element.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="67" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>New layer mode: Cover</h1>
<p>Unpoly 2 ships with a new layer mode called <code>cover</code>. It overlays the <em>entire</em> page, including application layout. It brings its own scrollbar.</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/path&quot;</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;cover&quot;</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>You often see cover overlays in mobile apps, e.g. on settings screens.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="68" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Overlays without history</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Modals without history required a lot of code in Unpoly 2.</strong></p>
<p>In Unpoly 1 you could use <code>{ history: false }</code> to open an overlay without updating the browser history. However, every user navigation within that overlay <em>would</em> affect history, unless you had <code>[up-history=false]</code> on <em>every</em> link. This is impractical, since a link should not need to know whether it is used within an overlay.</p>
<p>Unpoly 2 reworks that behavior to what you would expect:</p>
<ul>
<li>When an overlay is opened without history, no contained link or form will ever update history.</li>
<li>When an overlay without history opens another overlay, that other overlay will never update history.</li>
<li>Layers without history know their location (<code>up.layer.location</code>).</li>
<li>Layers without history support the <code>.up-current</code> class.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="69" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Navigation intent</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="70" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Switching screens vs. updating boxes</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Not all fragment updates are user navigation.</strong></p>
<p>When Unpoly 1 updates fragment, it applies many opinionated defaults:</p>
<ul>
<li>Update the browser location</li>
<li>Scroll to reveal the new fragment</li>
<li>Cache responses for 5 minutes</li>
<li>Replace <code>&lt;body&gt;</code> for unexpected responses</li>
</ul>
<p>While these are good defaults when the user follows a link a to <em>navigate</em> to a new screen,
they get in the way when you only want to update a small box.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="71" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>Actual usage often looked like this:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.replace(<span class="hljs-string">&#x27;.message-count&#x27;</span>, <span class="hljs-string">&#x27;/inbox&#x27;</span>, {
  <span class="hljs-attr">cache</span>: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// opt out of caching</span>
  <span class="hljs-attr">history</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// opt out of history</span>
  <span class="hljs-attr">reveal</span>: <span class="hljs-literal">false</span>,   <span class="hljs-comment">// opt out of scrolling</span>
  <span class="hljs-attr">fallback</span>: <span class="hljs-literal">false</span>  <span class="hljs-comment">// opt out of fallback targets</span>
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="72" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Unpoly 2 defaults are opt-in, not opt-out</h1>
<p>When updating a fragment in Unpoly 2 with <code>up.render()</code>, you will get <strong>very few defaults</strong>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Will not update history, will not scroll, etc.</span>
up.render(<span class="hljs-string">&#x27;.message-count&#x27;</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/inbox&#x27;</span> })
</span></span></foreignObject></svg></code></pre>
<p>Options are now <strong>opt-in</strong> instead of <strong>opt-out</strong>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Will update history, but not scroll, etc.</span>
up.render(<span class="hljs-string">&#x27;.message-count&#x27;</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/inbox&#x27;</span>, <span class="hljs-attr">history</span>: <span class="hljs-literal">true</span> })
</span></span></foreignObject></svg></code></pre>
<h3>Navigation defaults</h3>
<p>You can opt into defaults for user navigation with <code>{ navigate: true }</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Will update history, will scroll, etc.</span>
up.render(<span class="hljs-string">&#x27;.message-count&#x27;</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/inbox&#x27;</span>, <span class="hljs-attr">navigate</span>: <span class="hljs-literal">true</span> })
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="73" data-class="no-watermark" data-theme="unpoly2-slides" class="no-watermark" style="--class:no-watermark;--theme:unpoly2-slides;">
<h2>Full list of navigation defaults</h2>
<table>
<thead>
<tr>
<th>Option</th>
<th>Effect</th>
<th>Default</th>
<th>Navigation default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{ solo }</code></td>
<td>Cancel existing requests</td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>{ peel }</code></td>
<td>Close overlays when targeting a layer below</td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>{ feedback }</code></td>
<td>Set <code>.up-active</code> on the activated link</td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>{ fallback }</code></td>
<td>Update <code>&lt;body&gt;</code> for unexpected responses</td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>{ cache }</code></td>
<td>Cache responses for 5 minutes</td>
<td><code>false</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>{ history }</code></td>
<td>Update browser location and window title</td>
<td><code>false</code></td>
<td><code>'auto'</code></td>
</tr>
<tr>
<td><code>{ scroll }</code></td>
<td>Scroll to the new element</td>
<td><code>false</code></td>
<td><code>'auto'</code></td>
</tr>
<tr>
<td><code>{ focus }</code></td>
<td>Focus ater update</td>
<td><code>false</code></td>
<td><code>'auto'</code></td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="74" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>You can configure your navigation defaults with <code>up.fragment.config.navigateOptions</code>.</p>
<p><strong>Following links and submitting are still considered navigation</strong>.<br />
You can opt out with the <code>[up-navigate=false]</code> attribute.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="75" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Navigation shorthand</h2>
<p>Instead of <code>up.render({ navigate: true })</code> you may also use <code>up.navigate()</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Will update history, will scroll, etc.</span>
up.navigate(<span class="hljs-string">&#x27;.message-count&#x27;</span>, { <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/inbox&#x27;</span> })
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="76" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>User navigation aborts earlier requests</h1>
<div class="row">
<div class="col">
<p>Unpoly 1 has concurrency issues on slow connections:</p>
<ul>
<li>User clicks link #1</li>
<li>Server takes long to respond to #1</li>
<li>User clicks another link #2</li>
<li>Server responds with #2</li>
<li>Server responds with #1</li>
<li>User sees effects of #1 (but expected to see effects of #2)</li>
</ul>
</div>
<div class="col">
<p>In Unpoly 2 user navigation aborts existing requests,
reducing concurrency:</p>
<ul>
<li>User clicks link #1</li>
<li>Server takes long to respond to #1</li>
<li>User clicks another link #2</li>
<li>Unpoly cancels request for #1</li>
<li>Server responds with #2</li>
<li>User sees effects of #2</li>
</ul>
</div>
</div>
<p>You may disable this with <code>{ solo: false }</code> (JS) or <code>[up-solo=&quot;false&quot;]</code> (HTML)</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="77" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Quality of life improvements</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="78" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Targeting self-contained components</h1>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Demo: DeskBot cards</em></p>
<p>TODO: Implement self-contained components in the layers demo app, e.g. rating widget</p>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> We sometimes have multiple self-contained components on the same page.</strong></p>
<p>In Unpoly 2 the position of a clicked link may be considered when deciding which element to replace.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="79" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Example</h2>
<p>Let's say we have two links that replace <code>.card</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card1&quot;</span>&gt;</span>
  Card #1 preview
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/1&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card&quot;</span>&gt;</span>Show full card #1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card2&quot;</span>&gt;</span>
  Card #2 preview
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/2&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card&quot;</span>&gt;</span>Show full card #2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>When clicking &quot;Sow full card #2&quot;, Unpoly 1 would have replaced <code>.card</code>, matching the first card.</p>
<p>This makes it hard to use interactive components more than once in the same page.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="80" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Introducing <code>:closest</code></h2>
<p>In Unpoly 2, links may refer to the closest ancestor with the experimental <code>:closest</code> pseudo class:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card1&quot;</span>&gt;</span>
  Card #1 preview
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/1&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card:closest&quot;</span>&gt;</span>Show full card #1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card2&quot;</span>&gt;</span>
  Card #2 preview
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/2&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card:closest&quot;</span>&gt;</span>Show full card #2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>When clicking <em>&quot;Show full card #2&quot;</em>, Unpoly 2 will replace <code>#card2</code> matching the second card.</p>
<p>While the card container still requires a unique selector (e.g. <code>[id=card1]</code>), none of the content elements do need to know about it.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="81" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>This also works with descendant selectors:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card1&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/1/links&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card:closest .card-links&quot;</span>&gt;</span>Show card #2 links<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-links&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;card2&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/cards/2/links&quot;</span> <span class="hljs-attr">up-target</span>=<span class="hljs-string">&quot;.card:closest .card-links&quot;</span>&gt;</span>Show card #2 links<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;card-links&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>When clicking <em>&quot;Show card #2 links&quot;</em>, Unpoly 2 will replace <code>#card2 .card-links</code>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="82" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Dealing with compiler errors</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Unpoly 1 has undefined behavior when a compiler crashes.</strong></p>
<p>In Unpoly 2 a fragment update will always terminate cleanly:</p>
<ul>
<li>When a compiler throws an error, other compilers will now run anyway.</li>
<li>When a destructor throws an error, other destructors will now run anyway.</li>
</ul>
<p>In any case errors will be logged.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="83" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Calmer log</h1>
<img src="./images/log.png" alt="New log" class="picture" />
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="84" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> up:click</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> It's hard to observe <code>click</code> when an element <em>might</em> be <code>[up-instant]</code></strong>.</p>
<p>The <code>up:click</code> event is generally emitted when an element is clicked. However, for elements
with an <a href="/a-up-instant"><code>[up-instant]</code></a> attribute this event is emitted on <code>mousedown</code> instead.</p>
<p>This is useful to listen to links being activated, without needing to know whether
a link is <code>[up-instant]</code>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="85" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Example</h2>
<p>Assume we have two links, one of which is <code>[up-instant]</code>:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/one&quot;</span>&gt;</span>Link 1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/two&quot;</span> <span class="hljs-attr">up-instant</span>&gt;</span>Link 2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>This listener will be only called when the <em>first</em> link is activated:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  ...
})
</span></span></foreignObject></svg></code></pre>
<p>This listener will be called when <em>either</em> link is activated:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-built_in">document</span>.addEventListener(<span class="hljs-string">&#x27;up:click&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  ...
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="86" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Cancelation is forwarded</h2>
<p>If the user cancels an <code>up:click</code> event, the underlying <code>click</code> or <code>mousedown</code> will also be canceled.
The following cancelation methods will be forwarded:</p>
<ul>
<li><code>event.stopPropagation()</code></li>
<li><code>event.stopImmediatePropagation()</code></li>
<li><code>event.preventDefault()</code></li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="87" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Accessibility considerations</h2>
<p>If the user activates an element using their keyboard, the <code>up:click</code> event will be emitted
on <code>click</code>, even if the element has an <code>[up-instant]</code> attribute.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="88" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Unified scroll options</h1>
<p>All scroll-related options (<code>{ reveal, resetScroll, restoreScroll }</code>) have been reduced to a single option <code>{ scroll }</code>. It accepts one of the following values:</p>
<table>
<thead>
<tr>
<th>Option value</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>'target'</code></td>
<td>Reveal the updated fragment (Unpoly 1 default)</td>
</tr>
<tr>
<td><code>'top'</code></td>
<td>Scroll to the top</td>
</tr>
<tr>
<td><code>'restore'</code></td>
<td>Restore last known scroll position for URL</td>
</tr>
<tr>
<td><code>'hash'</code></td>
<td>Scroll to a #hash in the updated URL</td>
</tr>
<tr>
<td><code>Function(options)</code></td>
<td>Pass your own scrolling logic</td>
</tr>
<tr>
<td><code>false</code></td>
<td>Don't scroll</td>
</tr>
<tr>
<td><code>'auto'</code></td>
<td>Scroll to the top <strong>if</strong> updating a main target (see below)</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="89" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Calmer scrolling</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Unpoly 1 scrolled too much.</strong></p>
<p>Unpoly 1 always scrolled to reveal an updated fragment.
This default was chosen to reset scroll positions when navigating to another screen.</p>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Show demo on <a href="https://makandra.com">https://makandra.com</a>:</em></p>
<ul>
<li><em>Scroll down a long page</em></li>
<li><em>Follow a link in the navigation to a second page</em></li>
<li><em>Explain how without revealing, the second page would open with the first page's scroll positions</em></li>
</ul>
<p>However, this default also casued scrolling when a smaller fragment was updated.
E.g. when the user switches between tabs, they wouldn't expect scroll changes.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="90" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p><strong>Unpoly 2 no longer scrolls by default.</strong></p>
<p>Only when <strong>navigating</strong> the new default is <code>{ scroll: 'auto' }</code>, which <em>sometimes</em> scrolls:</p>
<ul>
<li>If the URL has a <code>#hash</code>, scroll to the hash.</li>
<li>If updating a main target, scroll to the top. The assumption here is that we navigated to a new screen.</li>
<li>Otherwise don't scroll.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="91" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Tuning the scroll effect</h1>
<table>
<thead>
<tr>
<th>Option</th>
<th>Meaning</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>{ revealPadding }</code></td>
<td>Pixels between element and viewport edge</td>
<td><code>0</code></td>
</tr>
<tr>
<td><code>{ revealTop }</code></td>
<td>Whether to move a revealed element to the top</td>
<td><code>false</code></td>
</tr>
<tr>
<td><code>{ revealMax }</code></td>
<td>How much of a high element to reveal</td>
<td><code>0.5 * innerHeight</code></td>
</tr>
<tr>
<td><code>{ revealSnap }</code></td>
<td>When to snap to the top edge</td>
<td><code>200</code></td>
</tr>
<tr>
<td><code>{ scrollBehavior }</code></td>
<td>auto/smooth</td>
<td><code>'auto'</code> (no animation)</td>
</tr>
<tr>
<td><code>{ scrollSpeed }</code></td>
<td>Acceleration of smooth scrolling</td>
<td><code>1</code> (mimic Chrome)</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="92" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Polling</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/>ï¸ Polling was a much-requested feature. Userland implementations often don't handle edge cases.</strong></p>
<p>Unpoly 2 ships with a polling implementation that handles edge cases.</p>
<h2>Basic example</h2>
<p>This reloads the fragment every 30 seconds:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;unread-messages&quot;</span> <span class="hljs-attr">up-poll</span>&gt;</span>
  You have 2 unread messages
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="93" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Configuring the poll interval</h2>
<p>You may set an optional <code>[up-interval]</code> attribute to change the reload interval:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;unread-messages&quot;</span> <span class="hljs-attr">up-poll</span> <span class="hljs-attr">up-interval</span>=<span class="hljs-string">&quot;10_000&quot;</span>&gt;</span>
  You have 2 unread messages
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>Digit groups separators (<code>60_000</code>) are a stage 3 ES6 feature and also supported in Unpoly number attributes.</p>
<p>You can also configure the interval default globally with <code>up.fragment.config.pollInterval</code>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="94" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Making poll requests cheap</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/>ï¸ Naive polling implementation will often cause unchanged content to be re-rendered.</strong></p>
<p>When reloading, Unpoly sends a timestamp for the current fragment (<code>X-Up-Reload-From</code> header).
You can compare this timestamp with the time of your last data update. If no more recent data
is available, you can render nothing:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MessagesController</span> &lt; ApplicationController</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span></span>
    <span class="hljs-keyword">if</span> up.reload_from_before?(current_user.last_message_at)
      up.render_nothing
    <span class="hljs-keyword">else</span>
      <span class="hljs-variable">@messages</span> = current_user.messages.order(<span class="hljs-symbol">time:</span> <span class="hljs-symbol">:desc</span>).to_a
    <span class="hljs-keyword">end</span>  
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="95" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Saving bandwidth</h2>
<p>This saves resources on your server, which spends most of its response time
rendering HTML.</p>
<p>This also reduces the bandwidth cost for a request/response exchange to <strong>~1 KB</strong>.</p>
<p>For comparison: A typical request/response exchange on <a href="https://makandracards.com/makandra">Cards</a> eats <strong>25-35 KB</strong>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="96" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Polling pauses for background tabs</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/>ï¸ Polling causes unnecessary server load when the polling tab is in the background,
or when users keep apps running over night.</strong></p>
<p>Unpoly 2 will only poll while the browser tab is visible.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="97" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Polling pauses on slow connections</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/>ï¸ A naive polling implementation can DoS slow cellular connections.</strong></p>
<p>Unpoly 2 will pause polling while the connection is slow.</p>
<h2>Slow connection?</h2>
<p>We consider a connection to be slow if at least one of these conditions are true:</p>
<ul>
<li>User has data saving enabled (&quot;Lite mode&quot; in Chrome)</li>
<li>TCP Round Trip Time is &gt;= 750 ms (<code>up.network.config.slowRTT</code>)</li>
<li>Downlink is &lt;= 600 Kbps (<code>up.network.config.slownDownlink</code>)</li>
</ul>
<p>The values above may change during a session.
Unpoly will enable/disable polling as conditions change.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="98" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Improved server integration</h1>
<p><em>TODO: Can we integrate this entire chapter in other slides?</em></p>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> In Unpoly 1 the server could not trigger changes in the frontend.</strong></p>
<p>Unpoly always had an <em>optional</em> <a href="https://unpoly.com/up.protocol">protocol</a>
your server may use to exchange additional
information when Unpoly is updating fragments. The protocol mostly works by adding
additional HTTP headers (like <code>X-Up-Target</code>) to requests and responses.</p>
<p>Unpoly 2 extends the optional protocol with <strong>additional headers</strong> that the server
may use to interact with the frontend.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="99" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Ruby on Rails examples ahead, but don't panic!</h2>
<p>The code examples on the following slides are for the <code>unpoly-rails</code> integration.
Expect integrations for other frameworks and languages to be updated for the new protocol
after the release of Unpoly 2.</p>
<p><strong>While you wait for your integration to be updated for Unpoly 2, existing protocol
implementations will keep working with an Unpoly 2 frontend</strong>.</p>
<p>You can use any new features by manually setting a response header as documented in <a href="https://unpoly.com/up.protocol">https://unpoly.com/up.protocol</a>.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="100" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Emitting frontend events from the server</h1>
<p>The server can emit events on the frontend. The following is Ruby code on the backend:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.emit(<span class="hljs-string">&#x27;user:selected&#x27;</span>, <span class="hljs-symbol">id:</span> <span class="hljs-number">5</span>)       <span class="hljs-comment"># emits on the document</span>
up.layer.emit(<span class="hljs-string">&#x27;user:selected&#x27;</span>, <span class="hljs-symbol">id:</span> <span class="hljs-number">5</span>) <span class="hljs-comment"># emits on the updated layer</span>
</span></span></foreignObject></svg></code></pre>
<p>The events are emitted before fragments are updated with the response HTML.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="101" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Closing layers from the server</h1>
<p>The server can now close layers. The following is Ruby code on the backend:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.dismiss()     <span class="hljs-comment"># the dismissal value is null</span>
up.layer.accept(<span class="hljs-symbol">id:</span> <span class="hljs-number">5</span>) <span class="hljs-comment"># the acceptance value is { id: 5}</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="102" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Changing the render target</h1>
<p>The server may instruct the frontend to render a different target by assigning a new CSS selector to the <code>up.target</code> property:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">unless</span> signed_in?
  up.target = <span class="hljs-string">&#x27;body&#x27;</span>
  render <span class="hljs-string">&#x27;sign_in&#x27;</span>
<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
<p>The frontend will use the server-provided target for both successful (HTTP status <code>200 OK</code>) and failed (status <code>4xx</code> or <code>5xx</code>) responses.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="103" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Rendering nothing</h1>
<p>Sometimes it's OK to render nothing, e.g. when you know that the current layer is going to be closed.</p>
<p>In this case you may call <code>up.render_nothing</code>:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotesController</span> &lt; ApplicationController</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    <span class="hljs-variable">@note</span> = Note.new(note_params)
    <span class="hljs-keyword">if</span> <span class="hljs-variable">@note</span>.save
      <span class="hljs-keyword">if</span> up.layer.overlay?
        up.accept_layer(<span class="hljs-variable">@note</span>.id)
        up.render_nothing
      <span class="hljs-keyword">else</span>
        redirect_to <span class="hljs-variable">@note</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
<p>This will render a 200 OK response with a header <code>X-Up-Target: :none</code> and an empty body.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="104" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Request meta information persists across redirects</h1>
<p>When Unpoly makes a request, it sends along meta information as request headers:</p>
<pre><code class="language-http"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">POST</span> <span class="hljs-string">/notes</span> HTTP/1.1
<span class="hljs-attribute">X-Up-Version</span>: 2.0
<span class="hljs-attribute">X-Up-Target</span>: foo
<span class="hljs-attribute">X-Up-Mode</span>: root
</span></span></foreignObject></svg></code></pre>
<p>In Unpoly 1, these headers were lost after a redirect.
Subsequent requests would see a non-Unpoly request.</p>
<p><strong>In Unpoly 2 meta information is persisted across redirects.</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="105" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p><strong>Example:</strong> Below the <code>#create</code> action saves a <code>Note</code> record and redirects to
that note's <code>#show</code> action. In Unpoly 2 the <code>#show</code> can still see if the
original request to <code>#create</code> was made by Unpoly, and not render an unneeded layout:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotesController</span> &lt; ApplicationController</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    <span class="hljs-variable">@note</span> = Note.new(note_params)
    <span class="hljs-keyword">if</span> <span class="hljs-variable">@note</span>.save
      redirect_to <span class="hljs-variable">@note</span>
    <span class="hljs-keyword">else</span>
      render <span class="hljs-string">&#x27;new&#x27;</span>  
    <span class="hljs-keyword">end</span>  
  <span class="hljs-keyword">end</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span></span>
    <span class="hljs-variable">@note</span> = Note.find(params[<span class="hljs-symbol">:id</span>])
    layout_needed = !up?
    render <span class="hljs-symbol">:show</span>, <span class="hljs-symbol">layout:</span> layout_needed
  <span class="hljs-keyword">end</span>

<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="106" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Inspecting the targeted layer</h1>
<p>The server now knows if the request is targeting an overlay:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.mode      <span class="hljs-comment"># &#x27;drawer&#x27;</span>
up.layer.overlay?  <span class="hljs-comment"># true</span>
up.layer.root?     <span class="hljs-comment"># false</span>
</span></span></foreignObject></svg></code></pre>
<p>Note that fragment updates may target different layers for successful (HTTP status <code>200 OK</code>) and failed (status <code>4xx</code> or <code>5xx</code>) responses. Use <code>up.fail_target</code> to learn about the
layer targeted for a failed update:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.fail_layer.mode      <span class="hljs-comment"># &#x27;root&#x27;</span>
up.fail_layer.overlay?  <span class="hljs-comment"># false</span>
up.fail_layer.root?     <span class="hljs-comment"># true</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="107" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Clearing the frontend cache</h1>
<p>The server can now clear Unpoly's client-side response cache:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.cache.clear
</span></span></foreignObject></svg></code></pre>
<p>You may also clear a single page:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.cache.clear(<span class="hljs-string">&#x27;/notes/1034&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
<p>You may also clear all entries matching a URL pattern:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.cache.clear(<span class="hljs-string">&#x27;/notes/*&#x27;</span>)
</span></span></foreignObject></svg></code></pre>
<p>You may also prevent cache clearing for an unsafe request:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.cache.keep
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="108" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p><strong>Example:</strong> Our index actions often have a search box to filter entries.
We sometimes persist a search query on the server and restore it for subsequent visits.</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>def NotesController &lt; ApplcationController

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span></span>
    <span class="hljs-keyword">if</span> params[<span class="hljs-symbol">:query</span>].<span class="hljs-literal">nil</span>?
      <span class="hljs-comment"># Restore a query from a previous visit.</span>
      query = current_user.last_notes_query
    <span class="hljs-keyword">else</span>
      query = params[<span class="hljs-symbol">:query</span>]
      <span class="hljs-comment"># Remember the query for the next visit.</span>
      current_user.update_attribute(<span class="hljs-symbol">:last_notes_query</span>, query)
      <span class="hljs-comment"># Earlier responses might now be cached with the wrong results,</span>
      <span class="hljs-comment"># so clear the cache for all index URLs.</span>
      up.cache.clear(<span class="hljs-string">&#x27;/notes/*&#x27;</span>)
    <span class="hljs-keyword">end</span>  

    <span class="hljs-variable">@notes</span> = Note.search(query).paginate
  <span class="hljs-keyword">end</span>
  ...
<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="109" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>up.proxy is now up.network</h1>
<p>Your calls will be forwarded.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="110" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Extended URL patterns</h1>
<p>Unpoly 1 supported URL wildcards like <code>/users/*</code> for <code>[up-alias]</code>.</p>
<p>Unpoly 2 supports extended URL patterns for <code>[up-alias]</code>, <code>[up-accept-location]</code> and <code>[up-dismiss-location]</code>:</p>
<table>
<thead>
<tr>
<th>Pattern</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/users/*</code></td>
<td>Any prefix</td>
</tr>
<tr>
<td><code>/users/1 /users/2</code></td>
<td>Space-separated alternatives (<code>OR</code>)</td>
</tr>
<tr>
<td><code>/users/:id</code></td>
<td>Capture segment (any string)</td>
</tr>
<tr>
<td><code>/users/$id</code></td>
<td>Capture segment (only integers)</td>
</tr>
<tr>
<td><code>/users/:id -/users/new</code></td>
<td>Exclude with minus-prefix</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="111" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> CSS selector extensions</h1>
<table>
<thead>
<tr>
<th>Target</th>
<th>What will be updated</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.foo</code></td>
<td>An element matching <code>.foo</code>.</td>
</tr>
<tr>
<td><code>.foo:has(.bar)</code></td>
<td>An element matching <code>.foo</code> with a descendant matching <code>.bar</code>.</td>
</tr>
<tr>
<td><code>:none</code></td>
<td>Nothing, but we still make a server request.</td>
</tr>
<tr>
<td><code>:layer</code></td>
<td>The first element in the current layer.</td>
</tr>
<tr>
<td><code>:main</code></td>
<td>Any element matching a main selector (default <code>main, [up-main]</code>).</td>
</tr>
<tr>
<td><code>.foo:closest</code></td>
<td>The activated element's closest ancestor matching <code>.foo</code>.</td>
</tr>
<tr>
<td><code>.foo:closest .child </code></td>
<td>An element matching <code>.child</code>  within the activated element's closest ancestor matching <code>.foo</code>.</td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="112" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Async functions no longer wait for animations</h1>
<p>In Unpoly 1 async functions didn't settle until animations finished.<br />
This often caused callbacks to run later than they could.</p>
<p>In Unpoly 2 fragment updates settle as soon as the DOM was changed.<br />
Any animation will play out after the promise has settled.</p>
<p>This generally makes code more responsive:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> up.layer.ask({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/users/new&#x27;</span> })
userSelect.value = user.id <span class="hljs-comment">// overlay may still be fading out</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="113" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>When you need to wait</h2>
<p>Unpoly 2 provides an <code>{ onFinished }</code> callback for cases when your code <em>does</em> need to wait for animations:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.render({
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/foo&#x27;</span>,
  <span class="hljs-attr">transition</span>: <span class="hljs-string">&#x27;cross-fade&#x27;</span>,
  <span class="hljs-attr">onFinished</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Transition has finished!&quot;</span>)
})

up.destroy(element, {
  <span class="hljs-attr">animation</span>: <span class="hljs-string">&#x27;fade-out&#x27;</span>,
  <span class="hljs-attr">onFinished</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Animation has finished&quot;</span>) 
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="114" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Optimizing cacheability</h1>
<p>Unpoly sends some additional HTTP headers to provide information about the fragment update:</p>
<table>
<thead>
<tr>
<th>Request property</th>
<th>Request header</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>up.Request#target</code></td>
<td><code>X-Up-Target</code></td>
</tr>
<tr>
<td><code>up.Request#failTarget</code></td>
<td><code>X-Up-Fail-Target</code></td>
</tr>
<tr>
<td><code>up.Request#context</code>     <img class="emoji" draggable="false" alt="ðŸ†•" src="https://twemoji.maxcdn.com/2/svg/1f195.svg" data-marp-twemoji=""/></td>
<td><code>X-Up-Context</code></td>
</tr>
<tr>
<td><code>up.Request#failContext</code> <img class="emoji" draggable="false" alt="ðŸ†•" src="https://twemoji.maxcdn.com/2/svg/1f195.svg" data-marp-twemoji=""/></td>
<td><code>X-Up-Fail-Context</code></td>
</tr>
<tr>
<td><code>up.Request#mode</code>        <img class="emoji" draggable="false" alt="ðŸ†•" src="https://twemoji.maxcdn.com/2/svg/1f195.svg" data-marp-twemoji=""/></td>
<td><code>X-Up-Mode</code></td>
</tr>
<tr>
<td><code>up.Request#failMode</code>    <img class="emoji" draggable="false" alt="ðŸ†•" src="https://twemoji.maxcdn.com/2/svg/1f195.svg" data-marp-twemoji=""/></td>
<td><code>X-Up-Fail-Mode</code></td>
</tr>
</tbody>
</table>
<p>The server may return an optimized response based on these properties,
e.g. by omitting a navigation bar that is not targeted.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="115" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>To <strong>improve cacheability</strong>, you may may set
<code>up.network.config.metaKeys</code> to a shorter list of property keys:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// Server only optimizes for layer mode, but not for target selector</span>
up.network.config.metaKeys = [<span class="hljs-string">&#x27;mode&#x27;</span>]<span class="hljs-string">&#x27;
</span></span></span></foreignObject></svg></code></pre>
<p>You may also send different request properties for different URLs:</p>
<pre><code class="language-javascript"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.network.config.metaKeys = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">request</span>) </span>{
  <span class="hljs-keyword">if</span> (request.url == <span class="hljs-string">&#x27;/search&#x27;</span>) {
    <span class="hljs-comment">// The server optimizes responses on the /search route.</span>
    <span class="hljs-keyword">return</span> [<span class="hljs-string">&#x27;target&#x27;</span>, <span class="hljs-string">&#x27;failTarget&#x27;</span>]
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// The server doesn&#x27;t optimize any other route,</span>
    <span class="hljs-comment">// so configure maximum cacheability.</span>
    <span class="hljs-keyword">return</span> []
  }
}
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="116" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Clearing the cache less</h1>
<p>By default, Unpoly clears the entire cache with every unsafe (non-<code>GET</code> request).
This is a safe default, but discards too many cache entries.</p>
<p>In Unpoly 2 the server may also clear a smaller scope, or keep the cache:</p>
<pre><code class="language-ruby"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>def NotesController &lt; ApplicationController

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span></span>
    <span class="hljs-variable">@note</span> = Note.create!(params[<span class="hljs-symbol">:note</span>].permit(...))
    <span class="hljs-keyword">if</span> <span class="hljs-variable">@note</span>.save
      up.cache.clear(<span class="hljs-string">&#x27;/notes/*&#x27;</span>) <span class="hljs-comment"># Only clear affected entries</span>
      redirect_to(<span class="hljs-variable">@note</span>)
    <span class="hljs-keyword">else</span>
      up.cache.keep <span class="hljs-comment"># Keep the cache because we haven&#x27;t saved</span>
      render <span class="hljs-string">&#x27;new&#x27;</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
  ...
<span class="hljs-keyword">end</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="117" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Smarter bandwidth usage</h1>
<ul>
<li>User navigation aborts existing requests</li>
<li>Preloading is now automatically disabled on slow connections</li>
<li>Preload requests are aborted as the user un-hovers the link</li>
<li>There is a single concurrency setting (default 4) for both regular requests and preload requests.</li>
<li>Preload starts on <code>touchstart</code></li>
<li>Bandwidth-friendly polling implementation (see below)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="118" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Slow connection?</h2>
<p>We consider a connection to be slow if at least one of these conditions are true:</p>
<ul>
<li>User has data saving enabled (&quot;Lite mode&quot; in Chrome)</li>
<li>TCP Round Trip Time is &gt;= 750 ms (<code>up.network.config.slowRTT</code>)</li>
<li>Downlink is &lt;= 600 Kbps (<code>up.network.config.slownDownlink</code>)</li>
</ul>
<p>The values above may change during a session.
Unpoly will enable/disable preloading as conditions change.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="119" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Unified fragment update API</h1>
<p>Unpoly 1 had many functions for updating fragments:<br />
<code>up.replace()</code>, <code>up.extract()</code>, <code>up.modal.extract()</code>, etc.</p>
<p>Unpoly 2 has unified these into a single function <code>up.render()</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.visit(<span class="hljs-string">&#x27;/path&#x27;</span>)                   =&gt; up.render({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/path&#x27;</span> })
up.modal.visit(<span class="hljs-string">&#x27;/path&#x27;</span>)             =&gt; up.render({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/path&#x27;</span>, <span class="hljs-attr">layer</span>: <span class="hljs-string">&#x27;new&#x27;</span> })
up.replace(<span class="hljs-string">&#x27;.element&#x27;</span>, <span class="hljs-string">&#x27;/path&#x27;</span>)     =&gt; up.render({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/path&#x27;</span>, <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;.element&#x27;</span> })
up.extract(<span class="hljs-string">&#x27;.element&#x27;</span>, <span class="hljs-string">&#x27;&lt;html&gt;...&#x27;</span>) =&gt; up.render({ <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;.element&#x27;</span>, <span class="hljs-attr">document</span>: <span class="hljs-string">&#x27;&lt;html&gt;...&#x27;</span> })
</span></span></foreignObject></svg></code></pre>
<p>Every kind of fragment update accepts the <strong>full set</strong> of <code>render()</code> options.</p>
<p>To update with a navigation intent, use either <code>{ navigate: true }</code> or <code>up.navigate()</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.render({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/path&#x27;</span>, <span class="hljs-attr">navigate</span>: <span class="hljs-literal">true</span> })  <span class="hljs-comment">// same as below</span>
up.navigate({ <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/path&#x27;</span> })                <span class="hljs-comment">// same as above</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="120" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Easy programmatic fragment changes</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Unpoly 1 required you to pass a target selector with every fragment update, which was very tedious. The selector was often the same, or inferable from context.</strong></p>
<p>Unpoly 2 lets you render fragments with fewer arguments.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="121" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Open a layer without content</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open()
</span></span></foreignObject></svg></code></pre>
<h2>Open a layer without target</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.layer.open({ <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;Helpful text&#x27;</span> }) <span class="hljs-comment">// opens in main target</span>
</span></span></foreignObject></svg></code></pre>
<p>This also works with HTML attributes:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span> <span class="hljs-attr">up-content</span>=<span class="hljs-string">&quot;Helpful text&quot;</span>&gt;</span>Help<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="122" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Derive target selector from HTML string</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-comment">// This will update .foo</span>
up.render({ <span class="hljs-attr">fragment</span>: <span class="hljs-string">&#x27;&lt;div class=&quot;.foo&quot;&gt;inner&lt;/div&gt;&#x27;</span> })
</span></span></foreignObject></svg></code></pre>
<h2>Change the inner content of an element</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.render({ <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;.foo&#x27;</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">&#x27;New inner HTML&#x27;</span> }
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="123" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Event handlers may change render options</h1>
<p>When the user interacts with links or forms, Unpoly will emit these events:</p>
<ul>
<li><code>up:link:follow</code></li>
<li><code>up:link:preload</code> (new in Unpoly 2)</li>
<li><code>up:form:submit</code></li>
<li><code>up:form:validate</code> (new in Unpoly 2)</li>
</ul>
<p>Event handlers may prevent these events to cancel the fragment update.</p>
<p><strong>Unpoly 2 also lets event listeners manipulate render options for the coming fragment update.</strong></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="124" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Basic example</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.on(<span class="hljs-string">&#x27;up:form:submit&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  event.renderOptions.failScroll = <span class="hljs-string">&#x27;.error-message&#x27;</span>
  event.renderOptions.failTransition = <span class="hljs-string">&#x27;shake&#x27;</span>
})
</span></span></foreignObject></svg></code></pre>
<p>If you have compilers that only set default attributes, consider using a single event listener that manipulates <code>event.renderOptions</code> instead. It's much leaner than a compiler, which needs to be called for every new fragment.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="125" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Pro example</h2>
<p>Assume we give a new attribute <code>[authorize]</code> to links that require a signed-in user:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/projects&quot;</span> <span class="hljs-attr">authorize</span>&gt;</span>My projects<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<p>When clicking the link without a session, a login form should open in a modal overlay.
When the user has signed in successfully, the overlay closes and the original link is followed.</p>
<p>We can implement this with the following handler:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.on(<span class="hljs-string">&#x27;up:link:follow&#x27;</span>, <span class="hljs-string">&#x27;a[authorize]&#x27;</span>, <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  <span class="hljs-keyword">if</span> (!isSignedIn()) {
    event.preventDefault()
    <span class="hljs-keyword">await</span> up.layer.ask(<span class="hljs-string">&#x27;/session/new&#x27;</span>, { <span class="hljs-attr">acceptLocation</span>: <span class="hljs-string">&#x27;/welcome&#x27;</span> })
    render(event.renderOptions)
  }
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="126" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Content Security Policy</h1>
<p>By choosing a strict CSP, you also decide against using event handlers in your HTML.</p>
<p>Handlers like <code>[up-on-accepted]</code> cannot work with CSP:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/contacts/new&quot;</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;new&quot;</span>
  <span class="hljs-attr">up-accept-location</span>=<span class="hljs-string">&quot;/contacts/$id&quot;</span>
  <span class="hljs-attr">up-on-accepted</span>=<span class="hljs-string">&quot;up.reload(&#x27;.table&#x27;)&quot;</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>  
</span></span></foreignObject></svg></code></pre>
<p>You will need to move your JavaScript code into your JavaScript sources.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="127" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>This is easier now that event handlers can change render options:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/contacts/new&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;add-contact&quot;</span> <span class="hljs-attr">up-follow</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.on(<span class="hljs-string">&#x27;up:link:follow&#x27;</span>, <span class="hljs-string">&#x27;.add-contact&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
  event.renderOptions.layer = <span class="hljs-string">&#x27;new&#x27;</span>
  event.renderOptions.acceptLocation = <span class="hljs-string">&#x27;/contacts/$id&#x27;</span>
  event.renderOptions.onAccepted = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> up.reload(<span class="hljs-string">&#x27;.table&#x27;</span>)
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="128" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> up.request() rework</h1>
<p>Unpoly 1 had a <code>up.request()</code> method to fetch HTML fragments for manual insertion.</p>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/>ï¸ What <code>up.request()</code> was often used for instead:</strong></p>
<ul>
<li><strong>A cross-browser alternative to jQuery's <code>$.ajax()</code></strong></li>
<li><strong>A cross-browser alternative to <code>fetch()</code> with a slightly nicer API</strong></li>
<li><strong>To fetch JSON from APIs.</strong></li>
</ul>
<p>Actual usage would often look like this:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> up.request(<span class="hljs-string">&#x27;/api/v3/json&#x27;</span>)
<span class="hljs-keyword">let</span> json = <span class="hljs-built_in">JSON</span>.parse(response.text)
</span></span></foreignObject></svg></code></pre>
<p><code>up.request()</code> was not really designed for that, e.g. every response was automatically cached.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="129" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>The cache is off by default</h2>
<p>Direct calls to <code>up.request()</code> no longer cache by default.</p>
<p>You can opt into caching with <code>{ cache: true }</code>.</p>
<p>Navigation intent will set <code>{ cache: true }</code> for you.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="130" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Parsing JSON</h2>
<p>To assist with API calls, Unpoly 2 adds <code>up.Response#json</code>:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> up.request(<span class="hljs-string">&#x27;/api/v3/foo&#x27;</span>)
<span class="hljs-built_in">console</span>.log(response.json)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="131" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Return value contains information about the request</h2>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> request = up.request(<span class="hljs-string">&#x27;/api/v3/foo&#x27;</span>)
<span class="hljs-built_in">console</span>.log(request.method) <span class="hljs-comment">// logs &quot;GET&quot;</span>

<span class="hljs-comment">// The request is also a promise for its response.</span>
<span class="hljs-keyword">let</span> response = <span class="hljs-keyword">await</span> request
<span class="hljs-built_in">console</span>.log(response.text)
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="132" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Requests are abortable</h2>
<p>You may now abort requests:</p>
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-keyword">let</span> request = up.request(<span class="hljs-string">&#x27;/api/v3/foo&#x27;</span>)
request.abort()
</span></span></foreignObject></svg></code></pre>
<p>This emits a new event <code>up:layer:aborted</code>.</p>
<p>We already learnt that user navigation now aborts existing requests.<br />
You may opt in and out of this with the <code>{ solo }</code> flag.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="133" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Tooltips are gone</h1>
<p>The tooltip component has been removed from Unpoly 2.</p>
<p>We want to focus on things that are hard to implement in userland.</p>
<p>Unpoly 2 converts <code>[up-tooltip]</code> attributes to <code>[title]</code> attributes.</p>
<h2>There are countless alternatives</h2>
<ul>
<li>Bootstrap tooltips (<a href="https://v5.getbootstrap.com/docs/5.0/components/tooltips/">5.0 docs</a>, <a href="https://getbootstrap.com/docs/4.5/components/tooltips/">4.5 docs</a>)</li>
<li><a href="https://kazzkiq.github.io/balloon.css/">Balloon.css</a> (CSS only)</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/title">Plain [title] attribute</a> (built into the browser)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="134" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Do you really want a tooltip?</h2>
<p>Touch devices <a href="https://makandracards.com/makandra/5117-touch-devices-don-t-have-mouseover-events">don't really have a &quot;hover&quot; state</a>.</p>
<p>That means that classic tooltips won't work on mobile. Consider a clickable popup instead:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">span</span>
  <span class="hljs-attr">up-layer</span>=<span class="hljs-string">&quot;popup&quot;</span>
  <span class="hljs-attr">up-content</span>=<span class="hljs-string">&quot;Locking a user will prevent them from using the application&quot;</span>&gt;</span>
  Help
<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="135" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Handling unexpected server responses</h1>
<p><strong><img class="emoji" draggable="false" alt="ðŸ’¡" src="https://twemoji.maxcdn.com/2/svg/1f4a1.svg" data-marp-twemoji=""/> Servers sometimes respond with a fatal error, a maintenance page or non-HTML content.<br />
Unpoly 1 didn't have a good way to deal with these exceptions.</strong></p>
<p>Unpoly 2 emits a new event <code>up:fragment:loaded</code> when the server responds with the HTML, before the HTML is used to <a href="/up.render">change a fragment</a>.</p>
<p>Event listeners may call <code>event.preventDefault()</code> on an <code>up:fragment:loaded</code> event to prevent any changes to the DOM and browser history. This is useful to detect an entirely different page layout (like a maintenance page or fatal server error) which should be open with a full page load.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="136" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<pre><code class="language-js"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap>up.on(<span class="hljs-string">&#x27;up:fragment:loaded&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">let</span> isMaintenancePage = event.response.getHeader(<span class="hljs-string">&#x27;X-Maintenance&#x27;</span>)

  <span class="hljs-keyword">if</span> (isMaintenancePage) {
    <span class="hljs-comment">// Prevent the fragment update and don&#x27;t update browser history</span>
    event.preventDefault()

    <span class="hljs-comment">// Make a full page load for the same request.</span>
    event.request.loadPage()
  }
})
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="137" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;"><h1>ðŸ¥‹ Accessibility <span class="muted">(A11Y)</span></h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="138" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Using the internet with visual impairments</h1>
<p><img class="emoji" draggable="false" alt="ðŸŽ¥" src="https://twemoji.maxcdn.com/2/svg/1f3a5.svg" data-marp-twemoji=""/> <em>Demo with VoiceVox on <a href="https://railslts.com">https://railslts.com</a></em></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="139" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Accessible JavaScript is hard</h1>
<p>Is this accessible for visually impaired users?<br />
<a href="https://codepen.io/triskweline/pen/abmZZJb">https://codepen.io/triskweline/pen/abmZZJb</a></p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="140" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Issues</h2>
<ul>
<li>The <em>Show details</em> and <em>Hide details</em> buttons cannot be focused</li>
<li>The <em>Show details</em> and <em>Hide details</em> buttons cannot be activated with the keyboard</li>
<li>When the modal is opened, the modal should be focused.</li>
<li>When the modal is closed, the link that opened the modal should be focused.</li>
<li>While the modal is open, background elements should be removed from the accessibility tree.</li>
<li>While the modal is open, focus should be trapped in a cycle within the modal.</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="141" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Guiding the user's focus</h1>
<p>Unpoly 2 provides an <code>[up-focus]</code> attribute (<code>{ focus }</code> option for JS).<br />
Use it to guide the user's focus as you update fragments.</p>
<h2>Example</h2>
<p>This would focus the updated fragment:</p>
<pre><code class="language-html"><svg data-marp-fitting="svg" data-marp-fitting-code><foreignObject><span data-marp-fitting-svg-content><span data-marp-fitting-svg-content-wrap><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/users/5&quot;</span> <span class="hljs-attr">up-focus</span>=<span class="hljs-string">&quot;target&quot;</span>&gt;</span>Load profile<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</span></span></foreignObject></svg></code></pre>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="142" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h2>Focus options</h2>
<table>
<thead>
<tr>
<th>Focus option</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>keep</code></td>
<td>Preserve focus if possible</td>
</tr>
<tr>
<td><code>target</code></td>
<td>Focus the updated fragment</td>
</tr>
<tr>
<td><code>layer</code></td>
<td>Focus the updated layer</td>
</tr>
<tr>
<td><code>autofocus</code></td>
<td>Focus any [autofocus] elements in the new fragment</td>
</tr>
<tr>
<td><code>auto</code></td>
<td>Navigation default <em>(see next slide)</em></td>
</tr>
</tbody>
</table>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="143" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<p>The default for user navigation is <code>{ focus: 'auto' }</code>:</p>
<ul>
<li>
<p><strong>When updating a fragment</strong>, try to preserve the focus.<br />
If nothing is focused, focus an <code>[autofocus]</code> element in the new fragment.</p>
</li>
<li>
<p><strong>When opening a layer</strong>, focus an <code>[autofocus]</code> element in the new layer.<br />
If no <code>[autofocus]</code> element exists, focus the layer.</p>
</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="144" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Preserving focus</h1>
<p>When updating a fragment that contains focus, <code>{ focus: 'keep' }</code> preserves:</p>
<ul>
<li>Cursor position (&quot;Caret&quot;)</li>
<li>Selection range</li>
<li>Scroll position (X/Y)</li>
</ul>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="145" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Overlays are accessible</h1>
<p>When on overlay is opened, the overlay is focused. Screen readers start reading the overlay content.</p>
<p>When an overlay closed, focus is returned to the link that originally opened the modal.</p>
<p>While the modal is open, focus is trapped in a cycle within the modal.</p>
<p>While an overlay is open, background elements are marked as outside the modal.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="146" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1><img class="emoji" draggable="false" alt="ðŸ¥‹" src="https://twemoji.maxcdn.com/2/svg/1f94b.svg" data-marp-twemoji=""/> Various A11Y improvements</h1>
<ul>
<li><code>[up-nav]</code> sets <code>[aria-current]</code> to the current link.</li>
<li>Links with an <a href="/a-up-instant"><code>[up-instant]</code></a> attribute can now be followed with the keyboard.</li>
<li>Fragments that are being <a href="/up.destroy">destroyed</a> now get an <a href="https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/ARIA_Techniques/Using_the_aria-hidden_attribute"><code>[aria-hidden=true]</code></a>
attribute while its disappearance is being animated. When a fragment is being swapped with a new version, the old fragment version is also
given <code>[aria-hidden=true]</code> while it's disappearing.</li>
<li>Overlays now get an <a href="https://a11ysupport.io/tech/aria/aria-modal_attribute"><code>[aria-modal=true]</code></a> attribute.</li>
</ul>
<p>Some of these features were backported to Unpoly 0.6.2.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="147" data-class="topic" data-theme="unpoly2-slides" class="topic" style="--class:topic;--theme:unpoly2-slides;">
<h1>Summary</h1>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="148" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Unpoly 2 objectives</h1>
<div class="row">
<div class="col">
<h3>Kill boilerplate configuration</h3>
<p>Repetitive configuration code is now the default.
New, unopionated Bootstrap integration.</p>
<h3>Layer API</h3>
<p>A new layer API replaces modals and popups.<br />
Layers are isolated and can be stacked infinitly.</p>
<h3>Sub-interactions</h3>
<p>Branch off sub-interaction into an overlay.<br />
Overlay results are propagated back to parent layer.</p>
</div>
<div class="col">
<h3>Navigation intent</h3>
<p>Not every fragment update means a user navigation.
Switching screens need other defaults than updating a box.</p>
<h3>Accessibility</h3>
<p>All Unpoly features carefully manage focus.
Keyboard navigation is supported everywhere.</p>
<h3>Quality of live improvements</h3>
<p>Extensive rework of almost all APIs.</p>
</div>
</div>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="149" data-theme="unpoly2-slides" style="--theme:unpoly2-slides;">
<h1>Breaking changes</h1>
<p>There's a short list of changes that we cannot fix with aliases.</p>
<h3>Overlays (modals, popups) have different HTML</h3>
<p>But it's similar. E.g. <code>&lt;div class=&quot;modal&quot;&gt;</code> becomes <code>&lt;up-modal&gt;</code>.</p>
<h3>Unpoly only sees the current layer</h3>
<p>You can target other layers with <code>{ layer: 'any' }</code>.</p>
<h3>Async functions no longer wait for animations</h3>
<p>You might or might not notice.</p>
<h3>Tooltips are no longer built-in</h3>
<p>But there are a million better libraries.</p>
</section>
</foreignObject></svg><svg data-marpit-svg="" viewBox="0 0 1280 720"><foreignObject width="1280" height="720"><section id="150" data-class="no-watermark" data-theme="unpoly2-slides" class="no-watermark" style="--class:no-watermark;--theme:unpoly2-slides;"><div class="title">
  <img src="./images/unpoly2.svg" alt="Unpoly 2" class="title--logo" />
  <div class="title--author">
    Henning Koch&nbsp; @triskweline
  </div>  
</div>
</section>
<script>!function(){"use strict";const t="marpitSVGPolyfill:setZoomFactor,",e=Symbol();let r,o;function n(n){const i="object"==typeof n&&n.target||document,a="object"==typeof n?n.zoom:n;window[e]||(Object.defineProperty(window,e,{configurable:!0,value:!0}),window.addEventListener("message",(({data:e,origin:r})=>{if(r===window.origin)try{if(e&&"string"==typeof e&&e.startsWith(t)){const[,t]=e.split(","),r=Number.parseFloat(t);Number.isNaN(r)||(o=r)}}catch(t){console.error(t)}})));let l=!1;Array.from(i.querySelectorAll("svg[data-marpit-svg]"),(t=>{var e,n,i,s;t.style.transform||(t.style.transform="translateZ(0)");const c=a||o||t.currentScale||1;r!==c&&(r=c,l=c);const d=t.getBoundingClientRect(),{length:u}=t.children;for(let r=0;r<u;r+=1){const o=t.children[r],a=o.getScreenCTM();if(a){const t=null!==(n=null===(e=o.x)||void 0===e?void 0:e.baseVal.value)&&void 0!==n?n:0,r=null!==(s=null===(i=o.y)||void 0===i?void 0:i.baseVal.value)&&void 0!==s?s:0,l=o.firstChild,{style:u}=l;u.transformOrigin||(u.transformOrigin=`${-t}px ${-r}px`),u.transform=`scale(${c}) matrix(${a.a}, ${a.b}, ${a.c}, ${a.d}, ${a.e-d.left}, ${a.f-d.top}) translateZ(0.0001px)`}}})),!1!==l&&Array.from(i.querySelectorAll("iframe"),(({contentWindow:e})=>{null==e||e.postMessage(`${t}${l}`,"null"===window.origin?"*":window.origin)}))}r=1,o=void 0;const i=(t,e,r)=>{if(t.getAttribute(e)!==r)return t.setAttribute(e,r),!0};function a({once:t=!1,target:e=document}={}){const r="Apple Computer, Inc."===navigator.vendor?[n]:[];let o=!t;const a=()=>{for(const t of r)t({target:e});!function(t=document){Array.from(t.querySelectorAll('svg[data-marp-fitting="svg"]'),(t=>{var e;const r=t.firstChild,o=r.firstChild,{scrollWidth:n,scrollHeight:a}=o;let l,s=1;if(t.hasAttribute("data-marp-fitting-code")&&(l=null===(e=t.parentElement)||void 0===e?void 0:e.parentElement),t.hasAttribute("data-marp-fitting-math")&&(l=t.parentElement),l){const t=getComputedStyle(l),e=Math.ceil(l.clientWidth-parseFloat(t.paddingLeft||"0")-parseFloat(t.paddingRight||"0"));e&&(s=e)}const c=Math.max(n,s),d=Math.max(a,1),u=`0 0 ${c} ${d}`;i(r,"width",`${c}`),i(r,"height",`${d}`),i(t,"preserveAspectRatio",getComputedStyle(t).getPropertyValue("--preserve-aspect-ratio")||"xMinYMin meet"),i(t,"viewBox",u)&&t.classList.toggle("__reflow__")}))}(e),o&&window.requestAnimationFrame(a)};return a(),()=>{o=!1}}const l=Symbol(),s=document.currentScript;((t=document)=>{if("undefined"==typeof window)throw new Error("Marp Core's browser script is valid only in browser context.");if(t[l])return t[l];const e=a({target:t}),r=()=>{e(),delete t[l]};Object.defineProperty(t,l,{configurable:!0,value:r})})(s?s.getRootNode():document)}();
</script></foreignObject></svg></div><div class="bespoke-marp-note" data-index="2" tabindex="0"><p>| Date    | Event              |
| ------- | ------------------ |
| 2018-02 | Start branch       |
| 2019-01 | `git reset --hard` |
| 2020-12 | Today              |
| 2021-01 | Release Unpoly 2   |</p></div><div class="bespoke-marp-note" data-index="3" tabindex="0"><p>- Kill boilerplate configuration
- Layer rewrite
- Sub-interactions
- Navigation intent
- Accessibility
- Quality of live improvements</p></div><div class="bespoke-marp-note" data-index="5" tabindex="0"><p>&lt;div class=&quot;columns&quot;&gt;

Kill boilerplate configuration
------------------------------
- Configure default targets.
- Handle all links/forms without helpers and macros.
- Minimal Bootstrap integration you actually want to use.

New layers
----------
- A new *layer* API replaces modals and popups. The root page is also a layer.
- Layers are now isolated. They cannot accidentally target another layer, or accidentally react to events from other layers.
- Layers may be stacked infinitely.
- Customize layers with fixed sizes, classes, custom dismissability.
- New full-screen overlay mode `cover`.

Sub-interactions
----------------
- Complex interactions may be paused by branching off a sub-interaction into an overlay.
- When opening an overlay you may define a *condition* when the sub-interaction ends.
- Overlay results (selection, finished record creation) are propagated back to parent layer.
- JavaScript may treat overlays as an async operation with a result value.

Navigation intent
------------------
- Not every fragment update means a user navigation (switching screens vs. updating a small fragment).
- Only user navigation scrolls, focuses, falls back to default targets.
- User navigation now aborts earlier requests.

Accessibility
-------------
- New `{ focus }` option lets you control focus after a fragment update.
- Overlays are accessible by trapping focus and removing other layers from the accessibility tree.
- Focus, selection, scroll positions within updated fragments are now preserved.
- Support keyboard navigations for all interactive elements.

Quality of live improvements
----------------------------
- Unified fragment update API.
- Server can emit emits, close overlays, clear the cache, ...
- Event handler may change render options.
- Calmer scrolling.
- Polling.
- New `:closest` selector for targeting self-contained components.
- Preloading eats less bandwidth and server resources

&lt;/div&gt;

----</p></div><div class="bespoke-marp-note" data-index="26" tabindex="0"><p>When updating fragments you have two additional options:

| Value  | Description                              |
| ------ | ---------------------------------------- |
| `swap` | Replace the front layer with a new layer |
| `new`  | Open a new layer                         |</p></div><div class="bespoke-marp-note" data-index="27" tabindex="0"><p># A single attribute for depth changes

You can always look at `[up-layer]` to know what layer is going to be updated.

If there is no `[up-layer]` attribute, you are going to update the current layer.


## Deprecation of old macros

`[up-modal]` is deprecated. Use `[up-layer=modal]` or `[up-layer=new]` instead.\
You can configure the mode for `[up-layer=new]` in `up.layer.config.mode`.

`[up-popup]` is deprecated. Use `[up-layer=popup]` instead.</p></div><div class="bespoke-marp-note" data-index="147" tabindex="0"><p>- Kill boilerplate configuration
- Layer rewrite
- Sub-interactions
- Navigation intent
- Accessibility
- Quality of live improvements</p></div><script>!function(){"use strict";var e=function(e,t){var n,r=1===(e.parent||e).nodeType?e.parent||e:document.querySelector(e.parent||e),s=[].filter.call("string"==typeof e.slides?r.querySelectorAll(e.slides):e.slides||r.children,(function(e){return"SCRIPT"!==e.nodeName})),a={},i=function(e,t){return(t=t||{}).index=s.indexOf(e),t.slide=e,t},o=function(e,t){a[e]=(a[e]||[]).filter((function(e){return e!==t}))},l=function(e,t){return(a[e]||[]).reduce((function(e,n){return e&&!1!==n(t)}),!0)},c=function(e,t){s[e]&&(n&&l("deactivate",i(n,t)),n=s[e],l("activate",i(n,t)))},d=function(e,t){var r=s.indexOf(n)+e;l(e>0?"next":"prev",i(n,t))&&c(r,t)},u={off:o,on:function(e,t){return(a[e]||(a[e]=[])).push(t),o.bind(null,e,t)},fire:l,slide:function(e,t){if(!arguments.length)return s.indexOf(n);l("slide",i(s[e],t))&&c(e,t)},next:d.bind(null,1),prev:d.bind(null,-1),parent:r,slides:s,destroy:function(e){l("destroy",i(n,e)),a={}}};return(t||[]).forEach((function(e){e(u)})),n||c(0),u};function t(e){e.parent.classList.add("bespoke-marp-parent"),e.slides.forEach((e=>e.classList.add("bespoke-marp-slide"))),e.on("activate",(t=>{const n=t.slide,r=!n.classList.contains("bespoke-marp-active");e.slides.forEach((e=>{e.classList.remove("bespoke-marp-active"),e.setAttribute("aria-hidden","true")})),n.classList.add("bespoke-marp-active"),n.removeAttribute("aria-hidden"),r&&(n.classList.add("bespoke-marp-active-ready"),document.body.clientHeight,n.classList.remove("bespoke-marp-active-ready"))}))}function n(e){let t=0,n=0;Object.defineProperty(e,"fragments",{enumerable:!0,value:e.slides.map((e=>[null,...e.querySelectorAll("[data-marpit-fragment]")]))});const r=r=>void 0!==e.fragments[t][n+r],s=(r,s)=>{t=r,n=s,e.fragments.forEach(((e,t)=>{e.forEach(((e,n)=>{if(null==e)return;const a=t<r||t===r&&n<=s;e.setAttribute("data-bespoke-marp-fragment",a?"active":"inactive"),t===r&&n===s?e.setAttribute("data-bespoke-marp-current-fragment","current"):e.removeAttribute("data-bespoke-marp-current-fragment")}))})),e.fragmentIndex=s;const a={slide:e.slides[r],index:r,fragments:e.fragments[r],fragmentIndex:s};e.fire("fragment",a)};e.on("next",(({fragment:a=!0})=>{if(a){if(r(1))return s(t,n+1),!1;const a=t+1;e.fragments[a]&&s(a,0)}else{const r=e.fragments[t].length;if(n+1<r)return s(t,r-1),!1;const a=e.fragments[t+1];a&&s(t+1,a.length-1)}})),e.on("prev",(({fragment:a=!0})=>{if(r(-1)&&a)return s(t,n-1),!1;const i=t-1;e.fragments[i]&&s(i,e.fragments[i].length-1)})),e.on("slide",(({index:t,fragment:n})=>{let r=0;if(void 0!==n){const s=e.fragments[t];if(s){const{length:e}=s;r=-1===n?e-1:Math.min(Math.max(n,0),e-1)}}s(t,r)})),s(0,0)}
/*!
* screenfull
* v5.0.2 - 2020-02-13
* (c) Sindre Sorhus; MIT License
*/
var r,s=(function(e){!function(){var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,r=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,s=n.length,a={};r<s;r++)if((e=n[r])&&e[1]in t){for(r=0;r<e.length;r++)a[n[0][r]]=e[r];return a}return!1}(),s={change:r.fullscreenchange,error:r.fullscreenerror},a={request:function(e){return new Promise(function(n,s){var a=function(){this.off("change",a),n()}.bind(this);this.on("change",a);var i=(e=e||t.documentElement)[r.requestFullscreen]();i instanceof Promise&&i.then(a).catch(s)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var s=function(){this.off("change",s),e()}.bind(this);this.on("change",s);var a=t[r.exitFullscreen]();a instanceof Promise&&a.then(s).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var r=s[e];r&&t.addEventListener(r,n,!1)},off:function(e,n){var r=s[e];r&&t.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(a,{isFullscreen:{get:function(){return Boolean(t[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[r.fullscreenEnabled])}}}),n?e.exports=a:window.screenfull=a):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()}(r={exports:{}},r.exports),r.exports);function a(e){e.fullscreen=()=>{s.isEnabled&&s.toggle(document.body)},document.addEventListener("keydown",(t=>{70!==t.which&&122!==t.which||t.altKey||t.ctrlKey||t.metaKey||!s.isEnabled||(e.fullscreen(),t.preventDefault())}))}function i(e=2e3){return t=>{let n;function r(){n&&clearTimeout(n),n=setTimeout((()=>{t.parent.classList.add("bespoke-marp-inactive"),t.fire("marp-inactive")}),e),t.parent.classList.contains("bespoke-marp-inactive")&&(t.parent.classList.remove("bespoke-marp-inactive"),t.fire("marp-active"))}document.addEventListener("mousedown",r),document.addEventListener("mousemove",r),document.addEventListener("touchend",r),setTimeout(r,0)}}const o=["AUDIO","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO"];function l(e){e.parent.addEventListener("keydown",(e=>{if(!e.target)return;const t=e.target;(o.includes(t.nodeName)||"true"===t.contentEditable)&&e.stopPropagation()}))}function c(e){window.addEventListener("load",(()=>{for(const t of e.slides){const e=t.querySelector("[data-marp-fitting]")?"":"hideable";t.setAttribute("data-bespoke-marp-load",e)}}))}var d;function u({interval:e=200}={}){return t=>{document.addEventListener("keydown",(e=>{if(32===e.which&&e.shiftKey)t.prev();else if(33===e.which||37===e.which||38===e.which)t.prev({fragment:!e.shiftKey});else if(32!==e.which||e.shiftKey)if(34===e.which||39===e.which||40===e.which)t.next({fragment:!e.shiftKey});else if(35===e.which)t.slide(t.slides.length-1,{fragment:-1});else{if(36!==e.which)return;t.slide(0)}else t.next();e.preventDefault()}));let n,r,s=0;t.parent.addEventListener("wheel",(a=>{let i=!1;const o=(e,t)=>{e&&(i=i||function(e,t){return function(e,t){const n=t===d.X?"Width":"Height";return e[`client${n}`]<e[`scroll${n}`]}(e,t)&&function(e,t){const{overflow:n}=e,r=e[`overflow${t}`];return"auto"===n||"scroll"===n||"auto"===r||"scroll"===r}(getComputedStyle(e),t)}(e,t)),(null==e?void 0:e.parentElement)&&o(e.parentElement,t)};if(0!==a.deltaX&&o(a.target,d.X),0!==a.deltaY&&o(a.target,d.Y),i)return;a.preventDefault(),r&&clearTimeout(r),r=setTimeout((()=>{n=0}),e);const l=Date.now()-s<e,c=Math.sqrt(Math.pow(a.deltaX,2)+Math.pow(a.deltaY,2)),u=c<=n;if(n=c,l||u)return;let f;(a.deltaX>0||a.deltaY>0)&&(f="next"),(a.deltaX<0||a.deltaY<0)&&(f="prev"),f&&(t[f](),s=Date.now())}))}}!function(e){e.X="X",e.Y="Y"}(d||(d={}));const f=(...e)=>history.replaceState(...e),m="data-bespoke-view";var p;!function(e){e.Normal="",e.Presenter="presenter",e.Next="next"}(p||(p={}));const h=(e,{protocol:t,host:n,pathname:r,hash:s}=location)=>{const a=e.toString();return`${t}//${n}${r}${a?"?":""}${a}${s}`},g=()=>{switch(document.body.getAttribute(m)){case p.Normal:return p.Normal;case p.Presenter:return p.Presenter;case p.Next:return p.Next;default:throw new Error("View mode is not assigned.")}},v=e=>new URLSearchParams(location.search).get(e),b=(e,t={})=>{const n=Object.assign({location:location,setter:f},t),r=new URLSearchParams(n.location.search);for(const t of Object.keys(e)){const n=e[t];"string"==typeof n?r.set(t,n):r.delete(t)}try{n.setter(null,document.title,h(r,n.location))}catch(e){console.error(e)}},w={available:(()=>{try{return localStorage.setItem("bespoke-marp","bespoke-marp"),localStorage.removeItem("bespoke-marp"),!0}catch(e){return console.warn("Warning: Using localStorage is restricted in the current host so some features may not work."),!1}})(),get:e=>{try{return localStorage.getItem(e)}catch(e){return null}},set:(e,t)=>{try{return localStorage.setItem(e,t),!0}catch(e){return!1}},remove:e=>{try{return localStorage.removeItem(e),!0}catch(e){return!1}}};function y(e=".bespoke-marp-osc"){const t=document.querySelector(e);if(!t)return()=>{};const n=(e,n)=>{t.querySelectorAll(`[data-bespoke-marp-osc=${JSON.stringify(e)}]`).forEach(n)};return s.isEnabled||n("fullscreen",(e=>e.style.display="none")),w.available||n("presenter",(e=>{e.disabled=!0,e.title="Presenter view is disabled due to restricted localStorage."})),e=>{t.addEventListener("click",(t=>{if(t.target instanceof HTMLElement){const{bespokeMarpOsc:n}=t.target.dataset;switch(n&&t.target.blur(),n){case"next":e.next({fragment:!t.shiftKey});break;case"prev":e.prev({fragment:!t.shiftKey});break;case"fullscreen":"function"==typeof e.fullscreen&&s.isEnabled&&e.fullscreen();break;case"presenter":e.openPresenterView()}}})),e.parent.appendChild(t),e.on("activate",(({index:t})=>{n("page",(n=>n.textContent=`Page ${t+1} of ${e.slides.length}`))})),e.on("fragment",(({index:t,fragments:r,fragmentIndex:s})=>{n("prev",(e=>e.disabled=0===t&&0===s)),n("next",(n=>n.disabled=t===e.slides.length-1&&s===r.length-1))})),e.on("marp-active",(()=>t.removeAttribute("aria-hidden"))),e.on("marp-inactive",(()=>t.setAttribute("aria-hidden","true"))),s.isEnabled&&s.onchange((()=>n("fullscreen",(e=>e.classList.toggle("exit",s.isEnabled&&s.isFullscreen)))))}}function x(){const e=Math.max(Math.floor(.85*window.innerWidth),640),t=Math.max(Math.floor(.85*window.innerHeight),360);return window.open(this.presenterUrl,`bespoke-marp-presenter-${this.syncKey}`,`width=${e},height=${t},menubar=no,toolbar=no`)}function k(){const e=new URLSearchParams(location.search);return e.set("view","presenter"),e.set("sync",this.syncKey),h(e)}var E=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];let L=e=>String(e).replace(/[&<>"']/g,(e=>`&${S[e]};`)),S={"&":"amp","<":"lt",">":"gt",'"':"quot","'":"apos"},I="dangerouslySetInnerHTML",P={className:"class",htmlFor:"for"},M={};function N(e,t){let n=[],r="";t=t||{};for(let e=arguments.length;e-- >2;)n.push(arguments[e]);if("function"==typeof e)return t.children=n.reverse(),e(t);if(e){if(r+="<"+e,t)for(let e in t)!1!==t[e]&&null!=t[e]&&e!==I&&(r+=` ${P[e]?P[e]:L(e)}="${L(t[e])}"`);r+=">"}if(-1===E.indexOf(e)){if(t[I])r+=t[I].__html;else for(;n.length;){let e=n.pop();if(e)if(e.pop)for(let t=e.length;t--;)n.push(e[t]);else r+=!0===M[e]?e:L(e)}r+=e?`</${e}>`:""}return M[r]=!0,r}const F=({children:e})=>N(null,null,...e),$="bespoke-marp-presenter-container",O="bespoke-marp-presenter-next",q="bespoke-marp-presenter-next-container",C="bespoke-marp-presenter-note-container",T="bespoke-marp-presenter-info-container",A="bespoke-marp-presenter-info-page",K="bespoke-marp-presenter-info-page-text",j="bespoke-marp-presenter-info-page-prev",R="bespoke-marp-presenter-info-page-next",U="bespoke-marp-presenter-info-time",D="bespoke-marp-presenter-info-timer";function V(e){const{title:t}=document;document.title="[Presenter view]"+(t?` - ${t}`:"");const n={},r=e=>(n[e]=n[e]||document.querySelector(`.${e}`),n[e]);document.body.appendChild((e=>{const t=document.createElement("div");return t.className=$,t.appendChild(e),t.insertAdjacentHTML("beforeend",N(F,null,N("div",{class:q},N("iframe",{class:O,src:"?view=next"})),N("div",{class:C}),N("div",{class:T},N("div",{class:A},N("button",{class:j,tabindex:"-1",title:"Previous"},"Previous"),N("span",{class:K}),N("button",{class:R,tabindex:"-1",title:"Next"},"Next")),N("time",{class:U,title:"Current time"}),N("div",{class:D})))),t})(e.parent)),(e=>{r(q).addEventListener("click",(()=>e.next()));const t=r(O),n=(s=t,(e,t)=>{var n;return null===(n=s.contentWindow)||void 0===n?void 0:n.postMessage(`navigate:${e},${t}`,"null"===window.origin?"*":window.origin)});var s;t.addEventListener("load",(()=>{r(q).classList.add("active"),n(e.slide(),e.fragmentIndex),e.on("fragment",(({index:e,fragmentIndex:t})=>n(e,t)))}));const a=document.querySelectorAll(".bespoke-marp-note");a.forEach((e=>{e.addEventListener("keydown",(e=>e.stopPropagation())),r(C).appendChild(e)})),e.on("activate",(()=>a.forEach((t=>t.classList.toggle("active",t.dataset.index==e.slide()))))),e.on("activate",(({index:t})=>{r(K).textContent=`${t+1} / ${e.slides.length}`}));const i=r(j),o=r(R);i.addEventListener("click",(t=>{i.blur(),e.prev({fragment:!t.shiftKey})})),o.addEventListener("click",(t=>{o.blur(),e.next({fragment:!t.shiftKey})})),e.on("fragment",(({index:t,fragments:n,fragmentIndex:r})=>{i.disabled=0===t&&0===r,o.disabled=t===e.slides.length-1&&r===n.length-1}));const l=()=>r(U).textContent=(new Date).toLocaleTimeString();l(),setInterval(l,250)})(e)}function X(e){const t=g();return t===p.Next&&e.appendChild(document.createElement("span")),e=>{t===p.Normal&&function(e){if(!(e=>e.syncKey&&"string"==typeof e.syncKey)(e))throw new Error("The current instance of Bespoke.js is invalid for Marp bespoke presenter plugin.");Object.defineProperties(e,{openPresenterView:{enumerable:!0,value:x},presenterUrl:{enumerable:!0,get:k}}),w.available&&document.addEventListener("keydown",(t=>{80!==t.which||t.altKey||t.ctrlKey||t.metaKey||(t.preventDefault(),e.openPresenterView())}))}(e),t===p.Presenter&&V(e),t===p.Next&&function(e){const t=t=>{if(t.origin!==window.origin)return;const[n,r]=t.data.split(":");if("navigate"===n){const[t,n]=r.split(",");let s=Number.parseInt(t,10),a=Number.parseInt(n,10)+1;a>=e.fragments[s].length&&(s+=1,a=0),e.slide(s,{fragment:a})}};window.addEventListener("message",t),e.on("destroy",(()=>window.removeEventListener("message",t)))}(e)}}function Y(e){e.on("activate",(t=>{document.querySelectorAll(".bespoke-progress-parent > .bespoke-progress-bar").forEach((n=>{n.style.flexBasis=100*t.index/(e.slides.length-1)+"%"}))}))}const B=e=>{const t=Number.parseInt(e,10);return Number.isNaN(t)?null:t};function z(e={}){const t=Object.assign({history:!0},e);return e=>{let n=!0;const r=e=>{const t=n;try{return n=!0,e()}finally{n=t}},s=(t={fragment:!0})=>{((t,n)=>{const{fragments:r,slides:s}=e,a=Math.max(0,Math.min(t,s.length-1)),i=Math.max(0,Math.min(n||0,r[a].length-1));a===e.slide()&&i===e.fragmentIndex||e.slide(a,{fragment:i})})((B(location.hash.slice(1))||1)-1,t.fragment?B(v("f")||""):null)};e.on("fragment",(({index:e,fragmentIndex:r})=>{n||b({f:0===r||r.toString()},{location:Object.assign(Object.assign({},location),{hash:`#${e+1}`}),setter:(...e)=>t.history?history.pushState(...e):history.replaceState(...e)})})),setTimeout((()=>{s(),window.addEventListener("hashchange",(()=>r((()=>{s({fragment:!1}),b({f:void 0})})))),window.addEventListener("popstate",(()=>{n||r((()=>s()))})),n=!1}),0)}}let H;function W(e={}){const t=e.key||((e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&n[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t})(),n=`bespoke-marp-sync-${t}`,r=()=>{const e=w.get(n);return e?JSON.parse(e):Object.create(null)},s=e=>{const t=r(),s=Object.assign(Object.assign({},t),e(t));return w.set(n,JSON.stringify(s)),s};return s((e=>({reference:(e.reference||0)+1}))),e=>{Object.defineProperty(e,"syncKey",{value:t,enumerable:!0});let a=!0;setTimeout((()=>{e.on("fragment",(e=>{a&&s((()=>({index:e.index,fragmentIndex:e.fragmentIndex})))}))}),0),window.addEventListener("storage",(t=>{if(t.key===n&&t.oldValue&&t.newValue){const n=JSON.parse(t.oldValue),r=JSON.parse(t.newValue);if(n.index!==r.index||n.fragmentIndex!==r.fragmentIndex)try{a=!1,e.slide(r.index,{fragment:r.fragmentIndex})}finally{a=!0}}})),e.on("destroy",(()=>{const{reference:e}=r();void 0===e||e<=1?w.remove(n):s((()=>({reference:e-1})))}))}}function J({slope:e=Math.tan(-35*Math.PI/180),swipeThreshold:t=30}={}){return n=>{let r;const s=n.parent,a=e=>{const t=s.getBoundingClientRect();return{x:e.pageX-(t.left+t.right)/2,y:e.pageY-(t.top+t.bottom)/2}};s.addEventListener("touchstart",(e=>{r=1===e.touches.length?a(e.touches[0]):void 0}),{passive:!0}),s.addEventListener("touchmove",(e=>{if(r)if(1===e.touches.length){e.preventDefault();const t=a(e.touches[0]),n=t.x-r.x,s=t.y-r.y;r.delta=Math.sqrt(Math.pow(Math.abs(n),2)+Math.pow(Math.abs(s),2)),r.radian=Math.atan2(n,s)}else r=void 0})),s.addEventListener("touchend",(s=>{if(r){if(r.delta&&r.delta>=t&&r.radian){let t=r.radian-e;t=(t+Math.PI)%(2*Math.PI)-Math.PI,n[t<0?"next":"prev"](),s.stopPropagation()}r=void 0}}),{passive:!0})}}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function _(e,t,n,r){return new(n||(n=Promise))((function(s,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,o)}l((r=r.apply(e,t||[])).next())}))}const G=()=>(void 0===H&&(H="wakeLock"in navigator&&navigator.wakeLock),H),Q=()=>_(void 0,void 0,void 0,(function*(){const e=G();if(e)try{const t=yield e.request("screen");return t.addEventListener("release",(()=>{console.debug("[Marp CLI] Wake Lock was released")})),console.debug("[Marp CLI] Wake Lock is active"),t}catch(e){console.warn(e)}return null}));function Z(){return _(this,void 0,void 0,(function*(){if(!G())return;let e;const t=()=>{e&&"visible"===document.visibilityState&&Q()};return document.addEventListener("visibilitychange",t),document.addEventListener("fullscreenchange",t),e=yield Q(),e}))}const ee=[p.Normal,p.Presenter,p.Next];!function(r=document.getElementById("p")){document.body.setAttribute(m,(()=>{switch(v("view")){case"next":return p.Next;case"presenter":return p.Presenter;default:return p.Normal}})());const s=(e=>{const t=v(e);return b({[e]:void 0}),t})("sync")||void 0,o=!1,d=!0,f=e(r,((...e)=>{const t=ee.findIndex((e=>g()===e));if(t<0)throw new Error("Invalid view");return e.map((([e,n])=>e[t]&&n)).filter((e=>e))})([[d,d,o],W({key:s})],[[d,d,d],X(r)],[[d,d,o],l],[[d,d,d],t],[[d,o,o],i()],[[d,d,d],c],[[d,d,d],z({history:!1})],[[d,d,o],u()],[[d,d,o],a],[[d,o,o],Y],[[d,d,o],J()],[[d,o,o],y()],[[d,d,d],n],[[d,d,o],Z]));window.addEventListener("beforeunload",(()=>b({sync:f.syncKey}))),window.addEventListener("unload",(()=>f.destroy()))}()}();</script></body></html>